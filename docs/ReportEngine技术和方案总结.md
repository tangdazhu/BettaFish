# BettaFish æŠ€æœ¯æ–‡æ¡£

æ¬¢è¿æ¥åˆ° BettaFish é¡¹ç›®çš„æŠ€æœ¯æ–‡æ¡£ä¸­å¿ƒï¼æœ¬ç›®å½•åŒ…å«äº†é¡¹ç›®ä¸­æ‰€æœ‰æ ¸å¿ƒå¼•æ“çš„è¯¦ç»†æŠ€æœ¯æ€»ç»“ã€‚

---

## ğŸ“š æ–‡æ¡£ç›®å½•

### å››å¤§æ ¸å¿ƒå¼•æ“

BettaFish é¡¹ç›®ç”±å››ä¸ªæ ¸å¿ƒå¼•æ“ç»„æˆï¼Œæ¯ä¸ªå¼•æ“è´Ÿè´£ä¸åŒçš„æ•°æ®é‡‡é›†å’Œåˆ†æä»»åŠ¡ï¼š

#### 1. QueryEngine - æ–°é—»æŸ¥è¯¢å¼•æ“
- ğŸ“„ [QueryEngineæ–°é—»æŸ¥è¯¢æŠ€æœ¯æ€»ç»“.md](./QueryEngineæ–°é—»æŸ¥è¯¢æŠ€æœ¯æ€»ç»“.md)
- **æ•°æ®æ¥æº**ï¼šå…¨çƒæ–°é—»æºï¼ˆTavily APIï¼‰
- **æ ¸å¿ƒåŠŸèƒ½**ï¼šå®æ—¶æ–°é—»è·å–ã€AIæ·±åº¦åˆ†æã€çµæ´»æ—¶é—´æ§åˆ¶
- **LLM æ¨¡å‹**ï¼šqwen-max

#### 2. MediaEngine - å¤šæ¨¡æ€æœç´¢å¼•æ“
- ğŸ“„ [MediaEngineå¤šæ¨¡æ€æœç´¢æŠ€æœ¯æ€»ç»“.md](./MediaEngineå¤šæ¨¡æ€æœç´¢æŠ€æœ¯æ€»ç»“.md)
- **æ•°æ®æ¥æº**ï¼šå…¨ç½‘æœç´¢ï¼ˆBocha APIï¼‰
- **æ ¸å¿ƒåŠŸèƒ½**ï¼šå¤šæ¨¡æ€èåˆã€åæ€è¿­ä»£ã€AIå¢å¼º
- **LLM æ¨¡å‹**ï¼šqwen-max

#### 3. InsightEngine - æœ¬åœ°èˆ†æƒ…å¼•æ“
- ğŸ“„ [InsightEngineæœ¬åœ°èˆ†æƒ…æ•°æ®åº“æŠ€æœ¯æ€»ç»“.md](./InsightEngineæœ¬åœ°èˆ†æƒ…æ•°æ®åº“æŠ€æœ¯æ€»ç»“.md)
- **æ•°æ®æ¥æº**ï¼šæœ¬åœ°æ•°æ®åº“ï¼ˆ7å¤§ç¤¾äº¤å¹³å°ï¼‰
- **æ ¸å¿ƒåŠŸèƒ½**ï¼šé›¶æˆæœ¬èˆ†æƒ…åˆ†æã€è·¨å¹³å°ç»Ÿä¸€æŸ¥è¯¢ã€æƒ…æ„Ÿåˆ†æ
- **LLM æ¨¡å‹**ï¼šqwen-max

#### 4. ReportEngine - ç»¼åˆæŠ¥å‘Šç”Ÿæˆå¼•æ“ â­
- ğŸ“„ [ReportEngineæ¶æ„è®¾è®¡.md](./ReportEngineæ¶æ„è®¾è®¡.md)
- ğŸ“„ [ReportEngineæ ¸å¿ƒç»„ä»¶.md](./ReportEngineæ ¸å¿ƒç»„ä»¶.md)
- ğŸ“„ [ReportEngineæ™ºèƒ½å‹ç¼©æœºåˆ¶.md](./ReportEngineæ™ºèƒ½å‹ç¼©æœºåˆ¶.md)
- ğŸ“„ [ReportEngineè°ƒè¯•æ€»ç»“.md](./ReportEngineè°ƒè¯•æ€»ç»“.md)
- **æ•°æ®æ¥æº**ï¼šæ•´åˆä¸‰ä¸ªå¼•æ“çš„åˆ†ææŠ¥å‘Š
- **æ ¸å¿ƒåŠŸèƒ½**ï¼šæ™ºèƒ½æ¨¡æ¿é€‰æ‹©ã€å¤šæºæ•°æ®æ•´åˆã€HTMLæŠ¥å‘Šç”Ÿæˆ
- **LLM æ¨¡å‹**ï¼šqwen-long

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### å››å±‚åˆ†ææ¶æ„

```
ç”¨æˆ·æŸ¥è¯¢
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç¬¬ä¸€å±‚ï¼šæ•°æ®é‡‡é›†                 â”‚
â”‚  QueryEngine | MediaEngine | InsightEngine â”‚
â”‚  (æ–°é—»)      | (å…¨ç½‘)      | (ç¤¾äº¤åª’ä½“)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç¬¬äºŒå±‚ï¼šä¸“ä¸šåˆ†æ                 â”‚
â”‚  ä¸‰ä¸ªå¼•æ“ä½¿ç”¨ qwen-max è¿›è¡Œæ·±åº¦åˆ†æ      â”‚
â”‚  ç”Ÿæˆä¸“ä¸šçš„ Markdown æŠ¥å‘Š                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç¬¬ä¸‰å±‚ï¼šæ™ºèƒ½å‹ç¼©                 â”‚
â”‚  ReportEngine å‹ç¼©è¾“å…¥æ•°æ®               â”‚
â”‚  é€‚é… LLM çš„ token é™åˆ¶                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç¬¬å››å±‚ï¼šç»¼åˆæŠ¥å‘Šç”Ÿæˆ             â”‚
â”‚  ReportEngine ä½¿ç”¨ qwen-long æ•´åˆ        â”‚
â”‚  ç”ŸæˆåŒ…å«æ•°æ®å¯è§†åŒ–çš„ HTML æŠ¥å‘Š          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æœ€ç»ˆ HTML æŠ¥å‘Š
```

---

## ğŸ”‘ æ ¸å¿ƒæŠ€æœ¯

### LLM æ¨¡å‹

| å¼•æ“ | æ¨¡å‹ | ç”¨é€” | ç‰¹ç‚¹ |
|------|------|------|------|
| QueryEngine | qwen-max | æ–°é—»åˆ†æ | é«˜è´¨é‡åˆ†æ |
| MediaEngine | qwen-max | å¤šæ¨¡æ€åˆ†æ | å¤šæ¨¡æ€ç†è§£ |
| InsightEngine | qwen-max | èˆ†æƒ…åˆ†æ | æƒ…æ„Ÿè¯†åˆ« |
| **ReportEngine** | **qwen-long** | **ç»¼åˆæ•´åˆ** | **è¶…é•¿ä¸Šä¸‹æ–‡** |

### æ•°æ®æ¥æº

| å¼•æ“ | æ•°æ®æº | å¹³å°é™åˆ¶ | å®æ—¶æ€§ |
|------|--------|---------|--------|
| QueryEngine | Tavily API | å…¨çƒæ–°é—»æº | å®æ—¶ |
| MediaEngine | Bocha API | æ— é™åˆ¶ | å®æ—¶ |
| InsightEngine | æœ¬åœ°æ•°æ®åº“ | 7å¤§ç¤¾äº¤å¹³å° | å–å†³äºçˆ¬å– |
| **ReportEngine** | **ä¸‰ä¸ªå¼•æ“æŠ¥å‘Š** | **æ— ** | **å®æ—¶** |

### æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”

| ç‰¹æ€§ | QueryEngine | MediaEngine | InsightEngine | ReportEngine |
|------|-------------|-------------|---------------|--------------|
| **æ•°æ®ç±»å‹** | æ–°é—»æ–‡ç«  | ç½‘é¡µ+å›¾ç‰‡+è§†é¢‘ | ç¤¾äº¤åª’ä½“å†…å®¹ | **åˆ†ææŠ¥å‘Š** |
| **è¾“å‡ºæ ¼å¼** | Markdown | Markdown | Markdown | **HTML** |
| **è¾“å‡ºé•¿åº¦** | 13,840 å­—ç¬¦ | 8,513 å­—ç¬¦ | 62,199 å­—ç¬¦ | **20,000+ å­—ç¬¦** |
| **å¯è§†åŒ–** | âŒ | âŒ | âŒ | **âœ… Chart.js** |
| **æˆæœ¬** | APIè´¹ç”¨ | APIè´¹ç”¨ | é›¶æˆæœ¬ | **APIè´¹ç”¨** |

---

## ğŸ“– å¿«é€Ÿå¼€å§‹

### é˜…è¯»é¡ºåºå»ºè®®

#### æ–°æ‰‹å…¥é—¨
1. å…ˆäº†è§£ä¸‰ä¸ªæ•°æ®é‡‡é›†å¼•æ“ï¼š
   - [QueryEngineæ–°é—»æŸ¥è¯¢æŠ€æœ¯æ€»ç»“](./QueryEngineæ–°é—»æŸ¥è¯¢æŠ€æœ¯æ€»ç»“.md)
   - [MediaEngineå¤šæ¨¡æ€æœç´¢æŠ€æœ¯æ€»ç»“](./MediaEngineå¤šæ¨¡æ€æœç´¢æŠ€æœ¯æ€»ç»“.md)
   - [InsightEngineæœ¬åœ°èˆ†æƒ…æ•°æ®åº“æŠ€æœ¯æ€»ç»“](./InsightEngineæœ¬åœ°èˆ†æƒ…æ•°æ®åº“æŠ€æœ¯æ€»ç»“.md)

2. å†æ·±å…¥ ReportEngineï¼š
   - [ReportEngineæ¶æ„è®¾è®¡](./ReportEngineæ¶æ„è®¾è®¡.md) - äº†è§£æ•´ä½“æ¶æ„
   - [ReportEngineæ ¸å¿ƒç»„ä»¶](./ReportEngineæ ¸å¿ƒç»„ä»¶.md) - äº†è§£å„ä¸ªç»„ä»¶
   - [ReportEngineæ™ºèƒ½å‹ç¼©æœºåˆ¶](./ReportEngineæ™ºèƒ½å‹ç¼©æœºåˆ¶.md) - äº†è§£å…³é”®æŠ€æœ¯
   - [ReportEngineè°ƒè¯•æ€»ç»“](./ReportEngineè°ƒè¯•æ€»ç»“.md) - å­¦ä¹ è°ƒè¯•ç»éªŒ

#### æ·±åº¦å­¦ä¹ 
1. **æ¶æ„è®¾è®¡**ï¼šç†è§£å››å±‚åˆ†ææ¶æ„çš„è®¾è®¡ç†å¿µ
2. **æ ¸å¿ƒç»„ä»¶**ï¼šæŒæ¡å„ä¸ªç»„ä»¶çš„èŒè´£å’Œå®ç°
3. **æ™ºèƒ½å‹ç¼©**ï¼šå­¦ä¹ å¦‚ä½•å¤„ç†è¶…å¤§è¾“å…¥æ•°æ®
4. **è°ƒè¯•ç»éªŒ**ï¼šäº†è§£å®é™…é—®é¢˜çš„è§£å†³è¿‡ç¨‹

---

## ğŸ¯ æ ¸å¿ƒäº®ç‚¹

### ReportEngine çš„åˆ›æ–°ç‚¹

1. **å…ƒåˆ†ææ¶æ„**
   - ä¸ç›´æ¥åˆ†æåŸå§‹æ•°æ®
   - æ•´åˆä¸‰ä¸ªä¸“ä¸šå¼•æ“çš„åˆ†æç»“æœ
   - æä¾›æ›´é«˜å±‚æ¬¡çš„ç»¼åˆè§†è§’

2. **æ™ºèƒ½å‹ç¼©æœºåˆ¶**
   - è§£å†³ LLM è¾“å…¥é™åˆ¶é—®é¢˜
   - ä¿ç•™å…³é”®ä¿¡æ¯ï¼ˆå‰ N ä¸ªå­—ç¬¦ï¼‰
   - å‹ç¼©ç‡ 95.1%ï¼Œä¿¡æ¯æŸå¤±æœ‰é™

3. **æ™ºèƒ½æ¨¡æ¿é€‰æ‹©**
   - 6 ç§é¢„è®¾æŠ¥å‘Šæ¨¡æ¿
   - LLM è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æ¨¡æ¿
   - æ”¯æŒè‡ªå®šä¹‰æ¨¡æ¿

4. **æ•°æ®å¯è§†åŒ–**
   - ä½¿ç”¨ Chart.js ç”Ÿæˆå›¾è¡¨
   - æƒ…æ„Ÿåˆ†æã€è¶‹åŠ¿åˆ†æã€æ•°æ®åˆ†å¸ƒ
   - äº¤äº’å¼ã€å“åº”å¼è®¾è®¡

5. **è¯¦ç»†çš„æç¤ºè¯å·¥ç¨‹**
   - æ˜ç¡®çš„å†…å®¹è¯¦ç»†ç¨‹åº¦è¦æ±‚
   - ç¦æ­¢è¿‡åº¦æ€»ç»“
   - æä¾›æ­£ç¡®/é”™è¯¯ç¤ºä¾‹

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **Python 3.x**ï¼šä¸»è¦ç¼–ç¨‹è¯­è¨€
- **OpenAI SDK**ï¼šLLM è°ƒç”¨ï¼ˆå…¼å®¹é˜¿é‡Œäº‘ DashScopeï¼‰
- **Loguru**ï¼šæ—¥å¿—ç®¡ç†
- **Dataclasses**ï¼šçŠ¶æ€ç®¡ç†

### LLM æ¨¡å‹
- **qwen-max**ï¼šå­å¼•æ“åˆ†æï¼ˆQueryEngineã€MediaEngineã€InsightEngineï¼‰
- **qwen-long**ï¼šç»¼åˆæŠ¥å‘Šç”Ÿæˆï¼ˆReportEngineï¼‰

### å‰ç«¯æŠ€æœ¯ï¼ˆç”Ÿæˆçš„ HTMLï¼‰
- **HTML5 + CSS3**ï¼šç°ä»£åŒ– UI
- **Chart.js**ï¼šæ•°æ®å¯è§†åŒ–
- **JavaScript**ï¼šäº¤äº’åŠŸèƒ½

### æ•°æ®æ ¼å¼
- **JSON**ï¼šæ•°æ®äº¤æ¢æ ¼å¼
- **Markdown**ï¼šæ¨¡æ¿æ ¼å¼
- **HTML**ï¼šæœ€ç»ˆæŠ¥å‘Šæ ¼å¼

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ReportEngine æ€§èƒ½

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **è¾“å…¥å‹ç¼©ç‡** | 95.1% | ä» 266,940 â†’ 13,000 å­—ç¬¦ |
| **è¾“å‡ºé•¿åº¦** | 20,000+ å­—ç¬¦ | è¯¦ç»†çš„ HTML æŠ¥å‘Š |
| **ç”Ÿæˆæ—¶é—´** | 184 ç§’ | åŒ…å« LLM è°ƒç”¨å’Œå¤„ç† |
| **æŠ¥å‘Šè´¨é‡** | â­â­â­â­â­ | è¯¦ç»†ã€æ•°æ®ä¸°å¯Œã€å¯è§†åŒ– |

### æ•°æ®æµ

```
åŸå§‹æ•°æ® (TBçº§)
    â†“ (æ•°æ®é‡‡é›†)
ä¸‰ä¸ªå¼•æ“çš„åŸå§‹æ•°æ® (MBçº§)
    â†“ (ä¸“ä¸šåˆ†æ - qwen-max)
ä¸‰ä¸ªå­æŠ¥å‘Š (84,552 å­—ç¬¦)
    â†“ (æ™ºèƒ½å‹ç¼© - ReportEngine)
å‹ç¼©åçš„è¾“å…¥ (13,000 å­—ç¬¦)
    â†“ (ç»¼åˆæ•´åˆ - qwen-long)
æœ€ç»ˆ HTML æŠ¥å‘Š (20,000+ å­—ç¬¦)
```

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

å¦‚æœä½ æƒ³ä¸ºæ–‡æ¡£åšå‡ºè´¡çŒ®ï¼š

1. **å‘ç°é”™è¯¯**ï¼šæäº¤ Issue è¯´æ˜é—®é¢˜
2. **æ”¹è¿›æ–‡æ¡£**ï¼šæäº¤ Pull Request
3. **æ·»åŠ ç¤ºä¾‹**ï¼šåˆ†äº«ä½ çš„ä½¿ç”¨ç»éªŒ
4. **æå‡ºå»ºè®®**ï¼šå¸®åŠ©æˆ‘ä»¬æ”¹è¿›æ–‡æ¡£ç»“æ„

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-11-13
- âœ… åˆ›å»º ReportEngine å®Œæ•´æŠ€æœ¯æ–‡æ¡£
- âœ… æ·»åŠ æ¶æ„è®¾è®¡ã€æ ¸å¿ƒç»„ä»¶ã€æ™ºèƒ½å‹ç¼©æœºåˆ¶ã€è°ƒè¯•æ€»ç»“
- âœ… æ•´åˆä¸‰ä¸ªå¼•æ“çš„æŠ€æœ¯æ–‡æ¡£
- âœ… åˆ›å»ºç»Ÿä¸€çš„æ–‡æ¡£ç´¢å¼•

---

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- **é¡¹ç›®åœ°å€**ï¼šBettaFish
- **æ–‡æ¡£ä½ç½®**ï¼š`doc/` ç›®å½•

---

**Happy Reading! ğŸ“–**

# ReportEngine æ™ºèƒ½å‹ç¼©æœºåˆ¶

## ğŸ“‹ ç›®å½•
- [é—®é¢˜èƒŒæ™¯](#é—®é¢˜èƒŒæ™¯)
- [qwen-long çš„é™åˆ¶](#qwen-long-çš„é™åˆ¶)
- [å‹ç¼©ç­–ç•¥è®¾è®¡](#å‹ç¼©ç­–ç•¥è®¾è®¡)
- [å®ç°ç»†èŠ‚](#å®ç°ç»†èŠ‚)
- [æ•ˆæœåˆ†æ](#æ•ˆæœåˆ†æ)

---

## é—®é¢˜èƒŒæ™¯

### è¾“å…¥æ•°æ®è§„æ¨¡

ReportEngine éœ€è¦æ•´åˆä¸‰ä¸ªå¼•æ“çš„æŠ¥å‘Šå’Œè®ºå›æ—¥å¿—ï¼š

| æ•°æ®æº | åŸå§‹å¤§å° | è¯´æ˜ |
|--------|---------|------|
| QueryEngine æŠ¥å‘Š | 13,840 å­—ç¬¦ | å…¨çƒæ–°é—»æ·±åº¦åˆ†æ |
| MediaEngine æŠ¥å‘Š | 8,513 å­—ç¬¦ | å¤šæ¨¡æ€ç»¼åˆåˆ†æ |
| InsightEngine æŠ¥å‘Š | 62,199 å­—ç¬¦ | èˆ†æƒ…æ·±åº¦åˆ†æ |
| è®ºå›æ—¥å¿— | 182,388 å­—ç¬¦ | ä¸‰ä¸ªå¼•æ“çš„è®¨è®ºå†…å®¹ |
| **æ€»è®¡** | **266,940 å­—ç¬¦** | **çº¦ 177,960 tokens** |

### é¢ä¸´çš„æŒ‘æˆ˜

**é—®é¢˜**ï¼šè¾“å…¥æ•°æ®è¿œè¶… LLM çš„å¤„ç†èƒ½åŠ›
- qwen-long çš„å•æ¡æ¶ˆæ¯é™åˆ¶ï¼š**9,000 tokens**
- å®é™…è¾“å…¥ï¼š**çº¦ 177,960 tokens**
- **è¶…å‡ºé™åˆ¶ 19.8 å€ï¼**

**åæœ**ï¼š
- âŒ LLM åªèƒ½çœ‹åˆ°å‰ 9,000 tokens çš„å†…å®¹
- âŒ å¤§éƒ¨åˆ†æ•°æ®è¢«æˆªæ–­ï¼Œæ— æ³•ä½¿ç”¨
- âŒ ç”Ÿæˆçš„æŠ¥å‘Šè´¨é‡æå·®ï¼ˆåªæœ‰ 6,688 å­—ç¬¦ï¼‰

---

## qwen-long çš„é™åˆ¶

### å®˜æ–¹æ–‡æ¡£è¯´æ˜

æ ¹æ®[é˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£](https://help.aliyun.com/zh/model-studio/user-guide/long-context-qwen-long)ï¼š

> **API è¾“å…¥é™åˆ¶**ï¼š
> - é€šè¿‡ **file-id** å¼•ç”¨æ—¶ï¼Œå•æ¬¡è¯·æ±‚æœ€å¤šå¼•ç”¨ 100 ä¸ªæ–‡ä»¶ã€‚æ€»ä¸Šä¸‹æ–‡é•¿åº¦ä¸Šé™ä¸º **1000 ä¸‡ Token**ã€‚
> - **ç›´æ¥åœ¨ user æˆ– system æ¶ˆæ¯ä¸­è¾“å…¥çº¯æ–‡æœ¬æ—¶ï¼Œå•æ¡æ¶ˆæ¯å†…å®¹ï¼ˆé file-idï¼‰é™åˆ¶åœ¨ 9,000 Token ä»¥å†…ã€‚**

### ä¸ºä»€ä¹ˆæœ‰è¿™ä¸ªé™åˆ¶ï¼Ÿ

#### æŠ€æœ¯æ¶æ„åŸå› 

**file-id æ–¹å¼**ï¼š
- æ–‡ä»¶ä¸Šä¼ åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
- æœåŠ¡å™¨ç«¯è¿›è¡Œé¢„å¤„ç†å’Œç´¢å¼•
- ä½¿ç”¨æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æŠ€æœ¯
- å¯ä»¥é«˜æ•ˆå¤„ç†è¶…é•¿æ–‡æœ¬ï¼ˆ1000 ä¸‡ tokensï¼‰

**çº¯æ–‡æœ¬æ–¹å¼**ï¼š
- ç›´æ¥åœ¨ API è¯·æ±‚ä¸­ä¼ é€’æ–‡æœ¬
- éœ€è¦åœ¨å•æ¬¡è¯·æ±‚ä¸­å¤„ç†æ‰€æœ‰å†…å®¹
- å—é™äº HTTP è¯·æ±‚å¤§å°å’Œå¤„ç†æ—¶é—´
- ä¸ºäº†ä¿è¯å“åº”é€Ÿåº¦å’Œç¨³å®šæ€§ï¼Œé™åˆ¶ä¸º 9,000 tokens

#### æ€§èƒ½å’Œæˆæœ¬è€ƒè™‘

| æ–¹å¼ | å¤„ç†æ–¹å¼ | æ€§èƒ½ | æˆæœ¬ |
|------|---------|------|------|
| **file-id** | æœåŠ¡å™¨ç«¯é¢„å¤„ç† + RAG | é«˜æ•ˆ | è¾ƒé«˜ï¼ˆéœ€è¦å­˜å‚¨ï¼‰ |
| **çº¯æ–‡æœ¬** | å®æ—¶å¤„ç† | å—é™ | è¾ƒä½ï¼ˆæ— å­˜å‚¨ï¼‰ |

### ä¸¤ç§è§£å†³æ–¹æ¡ˆå¯¹æ¯”

#### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ file-idï¼ˆæœªé‡‡ç”¨ï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… æ”¯æŒ 1000 ä¸‡ tokens è¾“å…¥
- âœ… ä¿ç•™å®Œæ•´ä¿¡æ¯
- âœ… æ— éœ€å‹ç¼©

**ç¼ºç‚¹**ï¼š
- âŒ éœ€è¦å¤§é‡ä»£ç æ”¹åŠ¨
- âŒ å¢åŠ ç³»ç»Ÿå¤æ‚åº¦
- âŒ éœ€è¦ç®¡ç†æ–‡ä»¶ä¸Šä¼ å’Œåˆ é™¤
- âŒ å¢åŠ  API è°ƒç”¨æˆæœ¬

#### æ–¹æ¡ˆ 2ï¼šæ™ºèƒ½å‹ç¼©ï¼ˆå·²é‡‡ç”¨ï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… å®ç°ç®€å•ï¼Œæ— éœ€æ”¹åŠ¨ç°æœ‰æ¶æ„
- âœ… ä¿ç•™å…³é”®ä¿¡æ¯ï¼ˆå‰ N ä¸ªå­—ç¬¦ï¼‰
- âœ… é™ä½ API è°ƒç”¨æˆæœ¬
- âœ… å“åº”é€Ÿåº¦å¿«

**ç¼ºç‚¹**ï¼š
- âš ï¸ ä¸¢å¤±éƒ¨åˆ†ä¿¡æ¯ï¼ˆä½†å…³é”®ä¿¡æ¯é€šå¸¸åœ¨å‰é¢ï¼‰
- âš ï¸ éœ€è¦åˆç†è®¾è®¡å‹ç¼©é…é¢

---

## å‹ç¼©ç­–ç•¥è®¾è®¡

### æ ¸å¿ƒæ€æƒ³

**å‡è®¾**ï¼šå…³é”®ä¿¡æ¯é€šå¸¸åœ¨æŠ¥å‘Šçš„å‰é¢éƒ¨åˆ†
- æŠ¥å‘Šé€šå¸¸é‡‡ç”¨"æ€»-åˆ†"ç»“æ„
- æ ¸å¿ƒè§‚ç‚¹å’Œæ•°æ®åœ¨å¼€å¤´
- åé¢æ˜¯è¯¦ç»†å±•å¼€å’Œæ¡ˆä¾‹

**ç­–ç•¥**ï¼šä¿ç•™æ¯ä¸ªæŠ¥å‘Šçš„å‰ N ä¸ªå­—ç¬¦

### å‹ç¼©é…é¢åˆ†é…

æ ¹æ®é‡è¦æ€§å’Œä¿¡æ¯å¯†åº¦ï¼Œåˆ†é…ä¸åŒçš„å­—ç¬¦é…é¢ï¼š

| æ•°æ®æº | åŸå§‹å¤§å° | å‹ç¼©é…é¢ | ä¿ç•™æ¯”ä¾‹ | ä¼˜å…ˆçº§ |
|--------|---------|---------|---------|--------|
| QueryEngine | 13,840 å­—ç¬¦ | 4,000 å­—ç¬¦ | 28.9% | é«˜ |
| MediaEngine | 8,513 å­—ç¬¦ | 4,000 å­—ç¬¦ | 47.0% | é«˜ |
| InsightEngine | 62,199 å­—ç¬¦ | 3,000 å­—ç¬¦ | 4.8% | ä¸­ |
| è®ºå›æ—¥å¿— | 182,388 å­—ç¬¦ | 2,000 å­—ç¬¦ | 1.1% | ä½ |
| **æ€»è®¡** | **266,940 å­—ç¬¦** | **13,000 å­—ç¬¦** | **4.9%** | - |

### ä¸ºä»€ä¹ˆè¿™æ ·åˆ†é…ï¼Ÿ

#### QueryEngineï¼ˆ4,000 å­—ç¬¦ï¼‰
- âœ… å…¨çƒæ–°é—»åˆ†æï¼Œä¿¡æ¯å¯†åº¦é«˜
- âœ… æä¾›æƒå¨æ•°æ®å’Œäº‹å®ä¾æ®
- âœ… åŸå§‹å¤§å°é€‚ä¸­ï¼Œå¯ä»¥å®Œæ•´ä¿ç•™å‰ 29%

#### MediaEngineï¼ˆ4,000 å­—ç¬¦ï¼‰
- âœ… å¤šæ¨¡æ€ç»¼åˆåˆ†æï¼Œè§†è§’ç‹¬ç‰¹
- âœ… æä¾›å…¨ç½‘æœç´¢ç»“æœå’Œå¤šåª’ä½“å†…å®¹
- âœ… åŸå§‹å¤§å°è¾ƒå°ï¼Œå¯ä»¥ä¿ç•™å‰ 47%

#### InsightEngineï¼ˆ3,000 å­—ç¬¦ï¼‰
- âš ï¸ åŸå§‹å¤§å°æœ€å¤§ï¼ˆ62K å­—ç¬¦ï¼‰
- âš ï¸ èˆ†æƒ…åˆ†æï¼Œéƒ¨åˆ†å†…å®¹é‡å¤
- âš ï¸ åªä¿ç•™å‰ 4.8%ï¼Œä½†è¶³ä»¥è¦†ç›–æ ¸å¿ƒè§‚ç‚¹

#### è®ºå›æ—¥å¿—ï¼ˆ2,000 å­—ç¬¦ï¼‰
- âš ï¸ åŸå§‹å¤§å°å·¨å¤§ï¼ˆ182K å­—ç¬¦ï¼‰
- âš ï¸ è®¨è®ºå†…å®¹ï¼Œä¿¡æ¯å¯†åº¦ä½
- âš ï¸ åªä¿ç•™å‰ 1.1%ï¼Œæå–å…³é”®è®¨è®ºç‚¹

### ç›®æ ‡ï¼š13,000 å­—ç¬¦

**è®¡ç®—**ï¼š
- 13,000 å­—ç¬¦ â‰ˆ 8,666 tokensï¼ˆ1.5 å­—ç¬¦/tokenï¼‰
- ç•™æœ‰ä½™é‡ï¼Œç¡®ä¿ä¸è¶…è¿‡ 9,000 tokens é™åˆ¶
- åŠ ä¸Š JSON æ ¼å¼å¼€é”€ï¼Œæœ€ç»ˆçº¦ 9,362 tokens âœ…

---

## å®ç°ç»†èŠ‚

### ä»£ç å®ç°

ä½ç½®ï¼š`ReportEngine/nodes/html_generation_node.py`

```python
def run(self, input_data: Dict[str, Any], **kwargs) -> str:
    # å‡†å¤‡ LLM è¾“å…¥æ•°æ®
    query_report = input_data.get('query_engine_report', '')
    media_report = input_data.get('media_engine_report', '')
    insight_report = input_data.get('insight_engine_report', '')
    forum_logs = input_data.get('forum_logs', '')
    
    # è®°å½•åŸå§‹æ•°æ®å¤§å°
    original_total = len(query_report) + len(media_report) + \
                     len(insight_report) + len(forum_logs)
    logger.info(f"åŸå§‹è¾“å…¥æ•°æ® - query: {len(query_report)}, "
               f"media: {len(media_report)}, "
               f"insight: {len(insight_report)}, "
               f"forum: {len(forum_logs)}, "
               f"æ€»è®¡: {original_total} å­—ç¬¦")
    
    # æ™ºèƒ½å‹ç¼©ï¼šå¦‚æœè¾“å…¥æ•°æ®è¿‡å¤§ï¼Œè¿›è¡Œå‹ç¼©
    max_total_chars = 13000
    
    # ä¸ºæ¯ä¸ªéƒ¨åˆ†åˆ†é…å­—ç¬¦é…é¢
    query_quota = min(len(query_report), 4000)
    media_quota = min(len(media_report), 4000)
    insight_quota = min(len(insight_report), 3000)
    forum_quota = min(len(forum_logs), 2000)
    
    # å¦‚æœæ€»é•¿åº¦è¶…è¿‡é™åˆ¶ï¼Œè¿›è¡Œæˆªæ–­
    if original_total > max_total_chars:
        logger.warning(f"âš ï¸ è¾“å…¥æ•°æ®è¿‡å¤§ï¼ˆ{original_total} å­—ç¬¦ï¼‰ï¼Œè¿›è¡Œæ™ºèƒ½å‹ç¼©...")
        query_report = query_report[:query_quota]
        media_report = media_report[:media_quota]
        insight_report = insight_report[:insight_quota]
        forum_logs = forum_logs[:forum_quota]
        compressed_total = len(query_report) + len(media_report) + \
                          len(insight_report) + len(forum_logs)
        logger.info(f"âœ“ å‹ç¼©å®Œæˆ - query: {len(query_report)}, "
                   f"media: {len(media_report)}, "
                   f"insight: {len(insight_report)}, "
                   f"forum: {len(forum_logs)}, "
                   f"æ€»è®¡: {compressed_total} å­—ç¬¦"
                   f"ï¼ˆå‹ç¼©ç‡: {compressed_total/original_total*100:.1f}%ï¼‰")
    
    # æ„å»º LLM è¾“å…¥
    llm_input = {
        "query": input_data.get("query", ""),
        "query_engine_report": query_report,
        "media_engine_report": media_report,
        "insight_engine_report": insight_report,
        "forum_logs": forum_logs,
        "selected_template": input_data.get("selected_template", "")
    }
    
    # è½¬æ¢ä¸º JSON æ ¼å¼ä¼ é€’ç»™ LLM
    message = json.dumps(llm_input, ensure_ascii=False, indent=2)
    
    # è®°å½•æœ€ç»ˆè¾“å…¥æ•°æ®å¤§å°
    total_chars = len(message)
    estimated_tokens = total_chars // 1.5
    logger.info(f"æœ€ç»ˆè¾“å…¥æ•°æ®ï¼ˆå«JSONæ ¼å¼ï¼‰: {total_chars} å­—ç¬¦ "
               f"(çº¦ {int(estimated_tokens)} tokens)")
    
    # è°ƒç”¨ LLM ç”Ÿæˆ HTML
    response = self.llm_client.invoke(
        SYSTEM_PROMPT_HTML_GENERATION,
        message,
        max_tokens=24000  # qwen-long çš„å¤§è¾“å‡º
    )
    
    return response
```

### æ—¥å¿—è¾“å‡ºç¤ºä¾‹

```
åŸå§‹è¾“å…¥æ•°æ® - query: 13840, media: 8513, insight: 62199, forum: 182388, æ€»è®¡: 266940 å­—ç¬¦
âš ï¸ è¾“å…¥æ•°æ®è¿‡å¤§ï¼ˆ266940 å­—ç¬¦ï¼‰ï¼Œè¿›è¡Œæ™ºèƒ½å‹ç¼©...
âœ“ å‹ç¼©å®Œæˆ - query: 4000, media: 4000, insight: 3000, forum: 2000, æ€»è®¡: 13000 å­—ç¬¦ï¼ˆå‹ç¼©ç‡: 4.9%ï¼‰
æœ€ç»ˆè¾“å…¥æ•°æ®ï¼ˆå«JSONæ ¼å¼ï¼‰: 14044 å­—ç¬¦ (çº¦ 9362 tokens)
LLMè°ƒç”¨å‚æ•° - max_tokens: 24000, model: qwen-long
LLMå“åº”é•¿åº¦: 20720 å­—ç¬¦, finish_reason: stop
```

---

## æ•ˆæœåˆ†æ

### å‹ç¼©å‰åå¯¹æ¯”

| æŒ‡æ ‡ | å‹ç¼©å‰ | å‹ç¼©å | å˜åŒ– |
|------|--------|--------|------|
| **è¾“å…¥å¤§å°** | 266,940 å­—ç¬¦ | 13,000 å­—ç¬¦ | â†“ 95.1% |
| **ä¼°ç®— tokens** | 177,960 tokens | 8,666 tokens | â†“ 95.1% |
| **æ˜¯å¦è¶…é™** | âŒ è¶…å‡º 19.8 å€ | âœ… ç¬¦åˆé™åˆ¶ | - |
| **LLM å“åº”** | 6,688 å­—ç¬¦ | 20,720 å­—ç¬¦ | â†‘ 210% |
| **æŠ¥å‘Šè´¨é‡** | âŒ ç®€å• | âœ… è¯¦ç»† | - |

### å®é™…æ•ˆæœ

#### å‹ç¼©å‰ï¼ˆæœªå¯ç”¨å‹ç¼©ï¼‰
```
è¾“å…¥: 266,940 å­—ç¬¦ (çº¦ 177,960 tokens) âŒ è¶…é™
LLM åªèƒ½çœ‹åˆ°å‰ 9,000 tokens
è¾“å‡º: 6,688 å­—ç¬¦ âŒ è¿‡äºç®€å•
```

#### å‹ç¼©åï¼ˆå¯ç”¨æ™ºèƒ½å‹ç¼©ï¼‰
```
è¾“å…¥: 13,000 å­—ç¬¦ (çº¦ 8,666 tokens) âœ… ç¬¦åˆé™åˆ¶
LLM å¯ä»¥çœ‹åˆ°å®Œæ•´è¾“å…¥
è¾“å‡º: 20,720 å­—ç¬¦ âœ… è¯¦ç»†ä¸°å¯Œ
```

### ä¿¡æ¯æŸå¤±åˆ†æ

è™½ç„¶å‹ç¼©ç‡é«˜è¾¾ 95.1%ï¼Œä½†å®é™…ä¿¡æ¯æŸå¤±æœ‰é™ï¼š

#### QueryEngineï¼ˆä¿ç•™ 28.9%ï¼‰
- âœ… æ ¸å¿ƒè§‚ç‚¹å®Œæ•´ä¿ç•™
- âœ… å…³é”®æ•°æ®ç‚¹å®Œæ•´ä¿ç•™
- âš ï¸ éƒ¨åˆ†è¯¦ç»†æ¡ˆä¾‹è¢«æˆªæ–­

#### MediaEngineï¼ˆä¿ç•™ 47.0%ï¼‰
- âœ… æ ¸å¿ƒè§‚ç‚¹å®Œæ•´ä¿ç•™
- âœ… å¤šæ¨¡æ€å†…å®¹æ‘˜è¦å®Œæ•´
- âš ï¸ éƒ¨åˆ†è¯¦ç»†åˆ†æè¢«æˆªæ–­

#### InsightEngineï¼ˆä¿ç•™ 4.8%ï¼‰
- âœ… æ ¸å¿ƒè§‚ç‚¹ä¿ç•™
- âœ… å…³é”®æ•°æ®ç‚¹ä¿ç•™
- âš ï¸ å¤§é‡è¯¦ç»†åˆ†æè¢«æˆªæ–­
- âš ï¸ è¿™æ˜¯æœ€å¤§çš„ä¿¡æ¯æŸå¤±æ¥æº

#### è®ºå›æ—¥å¿—ï¼ˆä¿ç•™ 1.1%ï¼‰
- âœ… å…³é”®è®¨è®ºç‚¹ä¿ç•™
- âš ï¸ å¤§é‡è®¨è®ºå†…å®¹è¢«æˆªæ–­
- âš ï¸ ä½†è®ºå›æ—¥å¿—æœ¬èº«ä¿¡æ¯å¯†åº¦ä½

### ä¼˜åŒ–å»ºè®®

å¦‚æœéœ€è¦æ›´é«˜è´¨é‡çš„æŠ¥å‘Šï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **æé«˜ InsightEngine é…é¢**ï¼šä» 3,000 â†’ 5,000 å­—ç¬¦
2. **é™ä½è®ºå›æ—¥å¿—é…é¢**ï¼šä» 2,000 â†’ 1,000 å­—ç¬¦
3. **ä½¿ç”¨ file-id æ–¹å¼**ï¼šæ”¯æŒå®Œæ•´è¾“å…¥ï¼ˆéœ€è¦ä»£ç æ”¹åŠ¨ï¼‰
4. **åˆ†æ®µç”Ÿæˆ**ï¼šå…ˆç”Ÿæˆå„éƒ¨åˆ†ï¼Œå†æ•´åˆï¼ˆå¢åŠ å¤æ‚åº¦ï¼‰

---

## æ€»ç»“

### å…³é”®æˆæœ

âœ… **æˆåŠŸè§£å†³è¾“å…¥è¶…é™é—®é¢˜**
- ä» 177,960 tokens â†’ 8,666 tokens
- ç¬¦åˆ qwen-long çš„ 9,000 tokens é™åˆ¶

âœ… **æ˜¾è‘—æå‡æŠ¥å‘Šè´¨é‡**
- ä» 6,688 å­—ç¬¦ â†’ 20,720 å­—ç¬¦
- æŠ¥å‘Šå†…å®¹è¯¦ç»†ã€æ•°æ®ä¸°å¯Œ

âœ… **å®ç°ç®€å•ã€ç»´æŠ¤æ–¹ä¾¿**
- æ— éœ€æ”¹åŠ¨ç°æœ‰æ¶æ„
- æ— éœ€ç®¡ç†æ–‡ä»¶ä¸Šä¼ 

### æŠ€æœ¯äº®ç‚¹

1. **æ™ºèƒ½é…é¢åˆ†é…**ï¼šæ ¹æ®é‡è¦æ€§å’Œä¿¡æ¯å¯†åº¦åˆ†é…
2. **è‡ªåŠ¨å‹ç¼©è§¦å‘**ï¼šåªåœ¨è¶…é™æ—¶æ‰å‹ç¼©
3. **è¯¦ç»†æ—¥å¿—è®°å½•**ï¼šæ–¹ä¾¿è°ƒè¯•å’Œç›‘æ§
4. **çµæ´»å¯è°ƒæ•´**ï¼šé…é¢å¯ä»¥æ ¹æ®éœ€æ±‚è°ƒæ•´

---

**ä¸‹ä¸€ç¯‡ï¼š[ReportEngineè°ƒè¯•æ€»ç»“](./ReportEngineè°ƒè¯•æ€»ç»“.md)**

# ReportEngine æ¶æ„è®¾è®¡

## ğŸ“‹ ç›®å½•
- [æ¦‚è¿°](#æ¦‚è¿°)
- [å››å±‚åˆ†ææ¶æ„](#å››å±‚åˆ†ææ¶æ„)
- [è®¾è®¡ç†å¿µ](#è®¾è®¡ç†å¿µ)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)

---

## æ¦‚è¿°

**ReportEngine** æ˜¯ BettaFish é¡¹ç›®çš„ç¬¬å››ä¸ªæ ¸å¿ƒå¼•æ“ï¼Œè´Ÿè´£æ•´åˆ QueryEngineã€MediaEngineã€InsightEngine ä¸‰ä¸ªä¸“ä¸šåˆ†æå¼•æ“çš„æŠ¥å‘Šï¼Œç”Ÿæˆç»Ÿä¸€çš„ã€å¯è§†åŒ–çš„ã€ä¸“ä¸šçš„ HTML ç»¼åˆæŠ¥å‘Šã€‚

### æ ¸å¿ƒå®šä½

ReportEngine æ˜¯ä¸€ä¸ª**å…ƒåˆ†æå¼•æ“ï¼ˆMeta-Analysis Engineï¼‰**ï¼š
- âŒ **ä¸æ˜¯**ï¼šç›´æ¥åˆ†æåŸå§‹æ•°æ®ï¼ˆæ–°é—»ã€ç½‘é¡µã€ç¤¾äº¤åª’ä½“ï¼‰
- âœ… **æ˜¯**ï¼šæ•´åˆä¸‰ä¸ªä¸“ä¸šå¼•æ“çš„åˆ†æç»“æœï¼Œç”Ÿæˆç»¼åˆæŠ¥å‘Š

### ä¸»è¦åŠŸèƒ½

1. **æ™ºèƒ½æ¨¡æ¿é€‰æ‹©**ï¼šæ ¹æ®æŸ¥è¯¢å†…å®¹è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æŠ¥å‘Šæ¨¡æ¿
2. **å¤šæºæ•°æ®æ•´åˆ**ï¼šæ•´åˆä¸‰ä¸ªå¼•æ“çš„åˆ†æç»“æœå’Œè®ºå›æ—¥å¿—
3. **æ™ºèƒ½æ•°æ®å‹ç¼©**ï¼šå¤„ç†è¶…å¤§è¾“å…¥æ•°æ®ï¼Œé€‚é… LLM çš„ token é™åˆ¶
4. **HTML æŠ¥å‘Šç”Ÿæˆ**ï¼šç”ŸæˆåŒ…å«æ•°æ®å¯è§†åŒ–çš„å®Œæ•´ HTML æŠ¥å‘Š
5. **çŠ¶æ€ç®¡ç†**ï¼šè·Ÿè¸ªæŠ¥å‘Šç”Ÿæˆè¿‡ç¨‹çš„çŠ¶æ€å’Œè¿›åº¦

---

## å››å±‚åˆ†ææ¶æ„

ReportEngine é‡‡ç”¨**å±‚æ¬¡åŒ–çš„åˆ†ææ¶æ„**ï¼Œå°†æ•°æ®é‡‡é›†ã€ä¸“ä¸šåˆ†æã€æ™ºèƒ½å‹ç¼©ã€ç»¼åˆæŠ¥å‘Šç”Ÿæˆåˆ†ä¸ºå››ä¸ªå±‚æ¬¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·æŸ¥è¯¢                              â”‚
â”‚        "AI Agentåœ¨è‡ªåŠ¨åŒ–æµç¨‹èƒ½åŠ›ä¸Šçš„æœ€æ–°è¿›å±•"             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç¬¬ä¸€å±‚ï¼šæ•°æ®é‡‡é›†                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  QueryEngine    â”‚  MediaEngine   â”‚  InsightEngine       â”‚
â”‚  (Tavily API)   â”‚  (Bocha API)   â”‚  (æœ¬åœ°æ•°æ®åº“)         â”‚
â”‚  â†“              â”‚  â†“             â”‚  â†“                   â”‚
â”‚  å…¨çƒæ–°é—»æº     â”‚  å…¨ç½‘æœç´¢      â”‚  7å¤§ç¤¾äº¤å¹³å°          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç¬¬äºŒå±‚ï¼šä¸“ä¸šåˆ†æ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  QueryEngine LLM    â”‚  MediaEngine LLM  â”‚  InsightEngine LLM â”‚
â”‚  (qwen-max)         â”‚  (qwen-max)       â”‚  (qwen-max)        â”‚
â”‚  â†“                  â”‚  â†“                â”‚  â†“                 â”‚
â”‚  æ–°é—»æ·±åº¦åˆ†ææŠ¥å‘Š   â”‚  å¤šæ¨¡æ€ç»¼åˆæŠ¥å‘Š   â”‚  èˆ†æƒ…åˆ†ææŠ¥å‘Š       â”‚
â”‚  (13,840 å­—ç¬¦)      â”‚  (8,513 å­—ç¬¦)     â”‚  (62,199 å­—ç¬¦)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç¬¬ä¸‰å±‚ï¼šæ™ºèƒ½å‹ç¼©                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‹ç¼©ç­–ç•¥ï¼šä¿ç•™æ¯ä¸ªæŠ¥å‘Šçš„å…³é”®éƒ¨åˆ†                         â”‚
â”‚  QueryEngine: 4000 å­—ç¬¦ (29%)                            â”‚
â”‚  MediaEngine: 4000 å­—ç¬¦ (47%)                            â”‚
â”‚  InsightEngine: 3000 å­—ç¬¦ (4.8%)                         â”‚
â”‚  è®ºå›æ—¥å¿—: 2000 å­—ç¬¦ (1.1%)                              â”‚
â”‚  æ€»è®¡: 13,000 å­—ç¬¦ (çº¦ 8,666 tokens)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç¬¬å››å±‚ï¼šç»¼åˆæŠ¥å‘Šç”Ÿæˆ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ReportEngine LLM (qwen-long)                            â”‚
â”‚  â†“                                                       â”‚
â”‚  æ•´åˆä¸‰ä¸ªå¼•æ“çš„åˆ†æç»“æœ + è®ºå›æ—¥å¿—                        â”‚
â”‚  â†“                                                       â”‚
â”‚  ç”Ÿæˆæœ€ç»ˆ HTML æŠ¥å‘Š (20,000+ å­—ç¬¦)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å„å±‚è¯¦ç»†è¯´æ˜

#### ç¬¬ä¸€å±‚ï¼šæ•°æ®é‡‡é›†
- **QueryEngine**ï¼šä» Tavily API è·å–å…¨çƒæ–°é—»æ•°æ®
- **MediaEngine**ï¼šä» Bocha API è·å–å…¨ç½‘æœç´¢ç»“æœï¼ˆç½‘é¡µã€å›¾ç‰‡ã€è§†é¢‘ï¼‰
- **InsightEngine**ï¼šä»æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢ 7 å¤§ç¤¾äº¤å¹³å°æ•°æ®

#### ç¬¬äºŒå±‚ï¼šä¸“ä¸šåˆ†æ
æ¯ä¸ªå¼•æ“ä½¿ç”¨ **qwen-max** è¿›è¡Œæ·±åº¦åˆ†æï¼š
- **QueryEngine**ï¼šåˆ†ææ–°é—»æ•°æ®ï¼Œç”Ÿæˆæ–°é—»æ·±åº¦åˆ†ææŠ¥å‘Š
- **MediaEngine**ï¼šåˆ†æå¤šæ¨¡æ€æ•°æ®ï¼Œç”Ÿæˆå¤šæ¨¡æ€ç»¼åˆæŠ¥å‘Š
- **InsightEngine**ï¼šåˆ†æèˆ†æƒ…æ•°æ®ï¼Œç”Ÿæˆèˆ†æƒ…åˆ†ææŠ¥å‘Š

#### ç¬¬ä¸‰å±‚ï¼šæ™ºèƒ½å‹ç¼©
ç”±äº qwen-long çš„ **9,000 tokens å•æ¡æ¶ˆæ¯é™åˆ¶**ï¼Œéœ€è¦æ™ºèƒ½å‹ç¼©ï¼š
- **å‹ç¼©ç­–ç•¥**ï¼šä¿ç•™æ¯ä¸ªæŠ¥å‘Šçš„å‰ N ä¸ªå­—ç¬¦ï¼ˆå…³é”®ä¿¡æ¯é€šå¸¸åœ¨å‰é¢ï¼‰
- **ä¼˜å…ˆçº§**ï¼šQueryEngine > MediaEngine > InsightEngine > è®ºå›æ—¥å¿—
- **ç›®æ ‡**ï¼šå‹ç¼©åˆ° 13,000 å­—ç¬¦ï¼ˆçº¦ 8,666 tokensï¼‰

#### ç¬¬å››å±‚ï¼šç»¼åˆæŠ¥å‘Šç”Ÿæˆ
**ReportEngine LLM (qwen-long)** çš„ä»»åŠ¡ï¼š
1. âœ… **æ•´åˆ**ä¸‰ä¸ªå¼•æ“çš„åˆ†æç»“æœ
2. âœ… **æå–**å…³é”®æ•°æ®ç‚¹å’Œæ¡ˆä¾‹
3. âœ… **ç»„ç»‡**æŒ‰ç…§é€‰å®šæ¨¡æ¿çš„ç»“æ„
4. âœ… **ç”Ÿæˆ**åŒ…å«æ•°æ®å¯è§†åŒ–çš„å®Œæ•´ HTML æŠ¥å‘Š

---

## è®¾è®¡ç†å¿µ

### 1. ä¸“ä¸šåˆ†å·¥
- æ¯ä¸ªå¼•æ“ä¸“æ³¨äºè‡ªå·±çš„æ•°æ®æºå’Œåˆ†ææ–¹æ³•
- ReportEngine ä¸“æ³¨äºæ•´åˆå’ŒæŠ¥å‘Šç”Ÿæˆ

### 2. æ·±åº¦åˆ†æ
- å­æŠ¥å‘Šå¯ä»¥éå¸¸è¯¦ç»†ï¼ˆ62K å­—ç¬¦ï¼‰
- ä¿ç•™ä¸“ä¸šåˆ†æçš„æ·±åº¦å’Œå¹¿åº¦

### 3. ç»¼åˆè§†è§’
- ReportEngine ä»æ›´é«˜å±‚æ¬¡æ•´åˆå¤šä¸ªè§†è§’
- æä¾›å…¨å±€æ€§çš„æ´å¯Ÿå’Œå»ºè®®

### 4. æ ¼å¼ç»Ÿä¸€
- ç”Ÿæˆç»Ÿä¸€çš„ HTML æŠ¥å‘Šæ ¼å¼
- åŒ…å«æ•°æ®å¯è§†åŒ–å’Œäº¤äº’åŠŸèƒ½

### 5. æ™ºèƒ½é€‚é…
- è‡ªåŠ¨å¤„ç†è¶…å¤§è¾“å…¥æ•°æ®
- é€‚é… LLM çš„ token é™åˆ¶

---

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæŠ€æœ¯
- **Python 3.x**ï¼šä¸»è¦ç¼–ç¨‹è¯­è¨€
- **OpenAI SDK**ï¼šLLM è°ƒç”¨ï¼ˆå…¼å®¹é˜¿é‡Œäº‘ DashScopeï¼‰
- **Loguru**ï¼šæ—¥å¿—ç®¡ç†
- **Dataclasses**ï¼šçŠ¶æ€ç®¡ç†

### LLM æ¨¡å‹
- **qwen-long**ï¼šç»¼åˆæŠ¥å‘Šç”Ÿæˆï¼ˆæ”¯æŒ 1000 ä¸‡ tokens ä¸Šä¸‹æ–‡ï¼Œ32,768 tokens è¾“å‡ºï¼‰
- **qwen-max**ï¼šå­å¼•æ“åˆ†æï¼ˆQueryEngineã€MediaEngineã€InsightEngineï¼‰

### å‰ç«¯æŠ€æœ¯ï¼ˆç”Ÿæˆçš„ HTMLï¼‰
- **HTML5 + CSS3**ï¼šç°ä»£åŒ– UI
- **Chart.js**ï¼šæ•°æ®å¯è§†åŒ–
- **JavaScript**ï¼šäº¤äº’åŠŸèƒ½

### æ•°æ®æ ¼å¼
- **JSON**ï¼šæ•°æ®äº¤æ¢æ ¼å¼
- **Markdown**ï¼šæ¨¡æ¿æ ¼å¼
- **HTML**ï¼šæœ€ç»ˆæŠ¥å‘Šæ ¼å¼

---

## æ•°æ®æµæ€»ç»“

```
åŸå§‹æ•°æ® (TBçº§)
    â†“ (æ•°æ®é‡‡é›† - QueryEngine/MediaEngine/InsightEngine)
ä¸‰ä¸ªå¼•æ“çš„åŸå§‹æ•°æ® (MBçº§)
    â†“ (ä¸“ä¸šåˆ†æ - qwen-max)
ä¸‰ä¸ªå­æŠ¥å‘Š (84,552 å­—ç¬¦)
    â†“ (æ™ºèƒ½å‹ç¼© - ReportEngine)
å‹ç¼©åçš„è¾“å…¥ (13,000 å­—ç¬¦)
    â†“ (ç»¼åˆæ•´åˆ - qwen-long)
æœ€ç»ˆ HTML æŠ¥å‘Š (20,000+ å­—ç¬¦)
```

---

## ä¸å…¶ä»–å¼•æ“çš„å…³ç³»

| ç‰¹æ€§ | QueryEngine | MediaEngine | InsightEngine | **ReportEngine** |
|------|-------------|-------------|---------------|------------------|
| **æ•°æ®æ¥æº** | å…¨çƒæ–°é—» | å…¨ç½‘æœç´¢ | æœ¬åœ°ç¤¾äº¤åª’ä½“ | **ä¸‰ä¸ªå¼•æ“æŠ¥å‘Š** |
| **åˆ†æå¯¹è±¡** | æ–°é—»æ–‡ç«  | å¤šæ¨¡æ€å†…å®¹ | èˆ†æƒ…æ•°æ® | **åˆ†æç»“æœ** |
| **LLM æ¨¡å‹** | qwen-max | qwen-max | qwen-max | **qwen-long** |
| **è¾“å‡ºæ ¼å¼** | Markdown | Markdown | Markdown | **HTML** |
| **è¾“å‡ºé•¿åº¦** | 13,840 å­—ç¬¦ | 8,513 å­—ç¬¦ | 62,199 å­—ç¬¦ | **20,000+ å­—ç¬¦** |
| **æ ¸å¿ƒåŠŸèƒ½** | æ–°é—»åˆ†æ | å¤šæ¨¡æ€åˆ†æ | èˆ†æƒ…åˆ†æ | **ç»¼åˆæ•´åˆ** |

---

**ä¸‹ä¸€ç¯‡ï¼š[ReportEngineæ ¸å¿ƒç»„ä»¶](./ReportEngineæ ¸å¿ƒç»„ä»¶.md)**

# ReportEngine æ ¸å¿ƒç»„ä»¶

## ğŸ“‹ ç›®å½•
- [ç»„ä»¶æ¶æ„](#ç»„ä»¶æ¶æ„)
- [ReportAgent ä¸»æ§åˆ¶å™¨](#reportagent-ä¸»æ§åˆ¶å™¨)
- [å¤„ç†èŠ‚ç‚¹ Nodes](#å¤„ç†èŠ‚ç‚¹-nodes)
- [LLM å®¢æˆ·ç«¯](#llm-å®¢æˆ·ç«¯)
- [çŠ¶æ€ç®¡ç† State](#çŠ¶æ€ç®¡ç†-state)
- [æç¤ºè¯ç³»ç»Ÿ Prompts](#æç¤ºè¯ç³»ç»Ÿ-prompts)
- [æ¨¡æ¿ç³»ç»Ÿ Templates](#æ¨¡æ¿ç³»ç»Ÿ-templates)

---

## ç»„ä»¶æ¶æ„

ReportEngine é‡‡ç”¨**æ¨¡å—åŒ–è®¾è®¡**ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š

```
ReportEngine/
â”œâ”€â”€ agent.py                    # ä¸»æ§åˆ¶å™¨
â”œâ”€â”€ llms/
â”‚   â””â”€â”€ base.py                # LLM å®¢æˆ·ç«¯
â”œâ”€â”€ nodes/
â”‚   â”œâ”€â”€ base_node.py           # èŠ‚ç‚¹åŸºç±»
â”‚   â”œâ”€â”€ template_selection_node.py  # æ¨¡æ¿é€‰æ‹©èŠ‚ç‚¹
â”‚   â””â”€â”€ html_generation_node.py     # HTML ç”ŸæˆèŠ‚ç‚¹
â”œâ”€â”€ state/
â”‚   â””â”€â”€ state.py               # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ prompts/
â”‚   â””â”€â”€ prompts.py             # æç¤ºè¯å®šä¹‰
â”œâ”€â”€ report_template/           # æŠ¥å‘Šæ¨¡æ¿
â”‚   â”œâ”€â”€ ä¼ä¸šå“ç‰Œå£°èª‰åˆ†ææŠ¥å‘Šæ¨¡æ¿.md
â”‚   â”œâ”€â”€ å¸‚åœºç«äº‰æ ¼å±€èˆ†æƒ…åˆ†ææŠ¥å‘Šæ¨¡æ¿.md
â”‚   â”œâ”€â”€ ç‰¹å®šæ”¿ç­–æˆ–è¡Œä¸šåŠ¨æ€èˆ†æƒ…åˆ†ææŠ¥å‘Š.md
â”‚   â””â”€â”€ ...
â””â”€â”€ utils/
    â””â”€â”€ config.py              # é…ç½®ç®¡ç†
```

---

## ReportAgent ä¸»æ§åˆ¶å™¨

### èŒè´£

`ReportAgent` æ˜¯ ReportEngine çš„æ ¸å¿ƒæ§åˆ¶å™¨ï¼Œè´Ÿè´£ï¼š
1. åˆå§‹åŒ–æ‰€æœ‰ç»„ä»¶ï¼ˆLLM å®¢æˆ·ç«¯ã€å¤„ç†èŠ‚ç‚¹ï¼‰
2. ç®¡ç†æŠ¥å‘Šç”Ÿæˆæµç¨‹
3. åè°ƒå„ä¸ªèŠ‚ç‚¹çš„æ‰§è¡Œ
4. å¤„ç†è¾“å…¥æ–‡ä»¶å’Œè¾“å‡ºæŠ¥å‘Š

### æ ¸å¿ƒæ–¹æ³•

#### `__init__(config)`
åˆå§‹åŒ– ReportAgentï¼š
```python
def __init__(self, config: Optional[Settings] = None):
    self.config = config or settings
    self.file_baseline = FileCountBaseline()  # æ–‡ä»¶åŸºå‡†ç®¡ç†
    self.llm_client = self._initialize_llm()  # LLM å®¢æˆ·ç«¯
    self._initialize_nodes()                   # å¤„ç†èŠ‚ç‚¹
    self.state = ReportState()                 # çŠ¶æ€ç®¡ç†
```

#### `generate_report(query, reports, forum_logs)`
ç”Ÿæˆç»¼åˆæŠ¥å‘Šçš„ä¸»æµç¨‹ï¼š
```python
def generate_report(self, query: str, reports: List[Any], 
                   forum_logs: str = "", custom_template: str = "", 
                   save_report: bool = True) -> str:
    # Step 1: æ¨¡æ¿é€‰æ‹©
    template_result = self._select_template(query, reports, forum_logs, custom_template)
    
    # Step 2: ç”Ÿæˆ HTML æŠ¥å‘Š
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
    
    # Step 3: ä¿å­˜æŠ¥å‘Š
    if save_report:
        self._save_report(html_report)
    
    return html_report
```

#### `check_input_files()`
æ£€æŸ¥è¾“å…¥æ–‡ä»¶æ˜¯å¦å‡†å¤‡å°±ç»ªï¼š
- ä½¿ç”¨ `FileCountBaseline` ç®¡ç†å™¨è·Ÿè¸ªæ–‡ä»¶æ•°é‡å˜åŒ–
- æ£€æµ‹ä¸‰ä¸ªå¼•æ“æ˜¯å¦éƒ½ç”Ÿæˆäº†æ–°æŠ¥å‘Š
- éªŒè¯è®ºå›æ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨

### FileCountBaseline æ–‡ä»¶åŸºå‡†ç®¡ç†å™¨

ç”¨äºè·Ÿè¸ªä¸‰ä¸ªå¼•æ“çš„æŠ¥å‘Šæ–‡ä»¶æ•°é‡å˜åŒ–ï¼š

```python
class FileCountBaseline:
    def initialize_baseline(self, directories):
        """åˆå§‹åŒ–æ–‡ä»¶æ•°é‡åŸºå‡†"""
        # è®°å½•å½“å‰æ¯ä¸ªç›®å½•çš„ .md æ–‡ä»¶æ•°é‡
        
    def check_new_files(self, directories):
        """æ£€æŸ¥æ˜¯å¦æœ‰æ–°æ–‡ä»¶"""
        # å¯¹æ¯”å½“å‰æ–‡ä»¶æ•°é‡ä¸åŸºå‡†
        # è¿”å›æ˜¯å¦æ‰€æœ‰å¼•æ“éƒ½æœ‰æ–°æ–‡ä»¶
        
    def get_latest_files(self, directories):
        """è·å–æ¯ä¸ªç›®å½•çš„æœ€æ–°æ–‡ä»¶"""
        # è¿”å›æœ€æ–°ä¿®æ”¹çš„æ–‡ä»¶è·¯å¾„
```

---

## å¤„ç†èŠ‚ç‚¹ Nodes

### èŠ‚ç‚¹åŸºç±» BaseNode

æ‰€æœ‰å¤„ç†èŠ‚ç‚¹çš„æŠ½è±¡åŸºç±»ï¼š

```python
class BaseNode(ABC):
    def __init__(self, llm_client: LLMClient, node_name: str = ""):
        self.llm_client = llm_client
        self.node_name = node_name
    
    @abstractmethod
    def run(self, input_data: Any, **kwargs) -> Any:
        """æ‰§è¡ŒèŠ‚ç‚¹å¤„ç†é€»è¾‘"""
        pass
    
    def validate_input(self, input_data: Any) -> bool:
        """éªŒè¯è¾“å…¥æ•°æ®"""
        pass
    
    def process_output(self, output: Any) -> Any:
        """å¤„ç†è¾“å‡ºæ•°æ®"""
        pass
```

### TemplateSelectionNode æ¨¡æ¿é€‰æ‹©èŠ‚ç‚¹

**åŠŸèƒ½**ï¼šæ ¹æ®æŸ¥è¯¢å†…å®¹å’ŒæŠ¥å‘Šç‰¹å¾ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æŠ¥å‘Šæ¨¡æ¿ã€‚

**è¾“å…¥**ï¼š
```python
{
    'query': 'ç”¨æˆ·æŸ¥è¯¢',
    'reports': [query_report, media_report, insight_report],
    'forum_logs': 'è®ºå›æ—¥å¿—å†…å®¹'
}
```

**è¾“å‡º**ï¼š
```python
{
    'template_name': 'ç‰¹å®šæ”¿ç­–æˆ–è¡Œä¸šåŠ¨æ€èˆ†æƒ…åˆ†ææŠ¥å‘Š',
    'template_content': 'æ¨¡æ¿å†…å®¹...',
    'selection_reason': 'é€‰æ‹©ç†ç”±...'
}
```

**æ ¸å¿ƒé€»è¾‘**ï¼š
1. åŠ è½½æ‰€æœ‰å¯ç”¨æ¨¡æ¿ï¼ˆä» `report_template/` ç›®å½•ï¼‰
2. æ„å»ºæ¨¡æ¿åˆ—è¡¨å’ŒæŠ¥å‘Šæ‘˜è¦
3. è°ƒç”¨ LLMï¼ˆqwen-longï¼‰è¿›è¡Œæ™ºèƒ½é€‰æ‹©
4. è§£æ LLM è¿”å›çš„ JSON ç»“æœ
5. å¦‚æœå¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ¨¡æ¿

**å…³é”®ä»£ç **ï¼š
```python
def _llm_template_selection(self, query, reports, forum_logs, available_templates):
    # æ„å»ºç”¨æˆ·æ¶ˆæ¯
    user_message = f"""æŸ¥è¯¢å†…å®¹: {query}
    æŠ¥å‘Šæ•°é‡: {len(reports)} ä¸ªåˆ†æå¼•æ“æŠ¥å‘Š
    å¯ç”¨æ¨¡æ¿: {template_list}
    è¯·æ ¹æ®æŸ¥è¯¢å†…å®¹é€‰æ‹©æœ€åˆé€‚çš„æ¨¡æ¿ã€‚"""
    
    # è°ƒç”¨ LLM
    response = self.llm_client.invoke(SYSTEM_PROMPT_TEMPLATE_SELECTION, user_message)
    
    # è§£æ JSON å“åº”
    result = json.loads(cleaned_response)
    return {
        'template_name': template['name'],
        'template_content': template['content'],
        'selection_reason': result.get('selection_reason')
    }
```

### HTMLGenerationNode HTML ç”ŸæˆèŠ‚ç‚¹

**åŠŸèƒ½**ï¼šæ•´åˆä¸‰ä¸ªå¼•æ“çš„æŠ¥å‘Šï¼Œç”ŸæˆåŒ…å«æ•°æ®å¯è§†åŒ–çš„å®Œæ•´ HTML æŠ¥å‘Šã€‚

**è¾“å…¥**ï¼š
```python
{
    'query': 'ç”¨æˆ·æŸ¥è¯¢',
    'query_engine_report': 'QueryEngine æŠ¥å‘Šå†…å®¹',
    'media_engine_report': 'MediaEngine æŠ¥å‘Šå†…å®¹',
    'insight_engine_report': 'InsightEngine æŠ¥å‘Šå†…å®¹',
    'forum_logs': 'è®ºå›æ—¥å¿—å†…å®¹',
    'selected_template': 'é€‰å®šçš„æ¨¡æ¿å†…å®¹'
}
```

**è¾“å‡º**ï¼š
```python
'<html>...</html>'  # å®Œæ•´çš„ HTML ä»£ç 
```

**æ ¸å¿ƒé€»è¾‘**ï¼š
1. **æ™ºèƒ½å‹ç¼©è¾“å…¥æ•°æ®**ï¼ˆå¦‚æœè¶…è¿‡ 13,000 å­—ç¬¦ï¼‰
2. è°ƒç”¨ LLMï¼ˆqwen-longï¼‰ç”Ÿæˆ HTML
3. å¤„ç† LLM è¾“å‡ºï¼ˆæ¸…ç† markdown ä»£ç å—æ ‡è®°ï¼‰
4. è¿”å›æœ€ç»ˆ HTML å†…å®¹

**æ™ºèƒ½å‹ç¼©æœºåˆ¶**ï¼š
```python
# åŸå§‹æ•°æ®å¤§å°
original_total = len(query_report) + len(media_report) + 
                 len(insight_report) + len(forum_logs)

# å¦‚æœè¶…è¿‡é™åˆ¶ï¼Œè¿›è¡Œæˆªæ–­
if original_total > 13000:
    query_report = query_report[:4000]      # ä¿ç•™å‰ 4000 å­—ç¬¦
    media_report = media_report[:4000]      # ä¿ç•™å‰ 4000 å­—ç¬¦
    insight_report = insight_report[:3000]  # ä¿ç•™å‰ 3000 å­—ç¬¦
    forum_logs = forum_logs[:2000]          # ä¿ç•™å‰ 2000 å­—ç¬¦
```

**ä¸ºä»€ä¹ˆæ˜¯ 13,000 å­—ç¬¦ï¼Ÿ**
- qwen-long çš„å•æ¡æ¶ˆæ¯é™åˆ¶ï¼š9,000 tokens
- 1.5 å­—ç¬¦ â‰ˆ 1 tokenï¼ˆç²—ç•¥ä¼°ç®—ï¼‰
- 13,000 å­—ç¬¦ â‰ˆ 8,666 tokensï¼ˆç•™æœ‰ä½™é‡ï¼‰

---

## LLM å®¢æˆ·ç«¯

### LLMClient ç±»

**åŠŸèƒ½**ï¼šç»Ÿä¸€çš„ OpenAI å…¼å®¹ LLM å®¢æˆ·ç«¯ï¼Œæ”¯æŒé‡è¯•æœºåˆ¶ã€‚

**åˆå§‹åŒ–**ï¼š
```python
class LLMClient:
    def __init__(self, api_key: str, model_name: str, base_url: Optional[str] = None):
        self.api_key = api_key
        self.model_name = model_name  # 'qwen-long'
        self.base_url = base_url      # DashScope API
        self.client = OpenAI(api_key=api_key, base_url=base_url)
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
@with_retry(LLM_RETRY_CONFIG)
def invoke(self, system_prompt: str, user_prompt: str, **kwargs) -> str:
    messages = [
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": user_prompt}
    ]
    
    # æ”¯æŒçš„å‚æ•°
    allowed_keys = {"temperature", "top_p", "max_tokens", ...}
    extra_params = {key: value for key, value in kwargs.items() 
                   if key in allowed_keys}
    
    # é»˜è®¤ max_tokens
    if "max_tokens" not in extra_params:
        extra_params["max_tokens"] = 16000  # qwen-long é»˜è®¤å€¼
    
    # è°ƒç”¨ API
    response = self.client.chat.completions.create(
        model=self.model_name,
        messages=messages,
        **extra_params
    )
    
    return response.choices[0].message.content
```

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… æ”¯æŒ `max_tokens` å‚æ•°ï¼ˆæ§åˆ¶è¾“å‡ºé•¿åº¦ï¼‰
- âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆä½¿ç”¨ `@with_retry` è£…é¥°å™¨ï¼‰
- âœ… æ—¥å¿—è®°å½•ï¼ˆè®°å½•è°ƒç”¨å‚æ•°å’Œå“åº”é•¿åº¦ï¼‰
- âœ… å“åº”éªŒè¯ï¼ˆå¤„ç† None å€¼ï¼‰

---

## çŠ¶æ€ç®¡ç† State

### ReportState ç±»

**åŠŸèƒ½**ï¼šè·Ÿè¸ªæŠ¥å‘Šç”Ÿæˆè¿‡ç¨‹çš„çŠ¶æ€å’Œè¿›åº¦ã€‚

**æ•°æ®ç»“æ„**ï¼š
```python
@dataclass
class ReportState:
    task_id: str = ""                    # ä»»åŠ¡ ID
    query: str = ""                      # åŸå§‹æŸ¥è¯¢
    status: str = "pending"              # çŠ¶æ€
    
    # è¾“å…¥æ•°æ®
    query_engine_report: str = ""
    media_engine_report: str = ""
    insight_engine_report: str = ""
    forum_logs: str = ""
    
    # å¤„ç†ç»“æœ
    selected_template: str = ""
    html_content: str = ""
    
    # å…ƒæ•°æ®
    metadata: ReportMetadata = field(default_factory=ReportMetadata)
```

**çŠ¶æ€è½¬æ¢**ï¼š
```python
pending â†’ processing â†’ completed
                    â†“
                  failed
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
def mark_processing(self):
    """æ ‡è®°ä¸ºå¤„ç†ä¸­"""
    self.status = "processing"

def mark_completed(self):
    """æ ‡è®°ä¸ºå®Œæˆ"""
    self.status = "completed"

def get_progress(self) -> float:
    """è·å–è¿›åº¦ç™¾åˆ†æ¯”"""
    if self.status == "completed":
        return 100.0
    elif self.status == "processing":
        progress = 0.0
        if self.selected_template:
            progress += 30.0
        if self.html_content:
            progress += 70.0
        return progress
    return 0.0

def save_to_file(self, file_path: str):
    """ä¿å­˜çŠ¶æ€åˆ° JSON æ–‡ä»¶"""
    # ä¸ä¿å­˜å®Œæ•´çš„ HTML å†…å®¹ï¼ˆå¤ªå¤§ï¼‰
```

---

## æç¤ºè¯ç³»ç»Ÿ Prompts

### SYSTEM_PROMPT_TEMPLATE_SELECTION

**ç”¨é€”**ï¼šæŒ‡å¯¼ LLM é€‰æ‹©æœ€åˆé€‚çš„æŠ¥å‘Šæ¨¡æ¿ã€‚

**å…³é”®å†…å®¹**ï¼š
- 6 ç§å¯ç”¨æ¨¡æ¿ç±»å‹åŠå…¶é€‚ç”¨åœºæ™¯
- é€‰æ‹©æ ‡å‡†ï¼ˆä¸»é¢˜ç±»å‹ã€ç´§æ€¥ç¨‹åº¦ã€åˆ†ææ·±åº¦ã€ç›®æ ‡å—ä¼—ï¼‰
- JSON è¾“å‡ºæ ¼å¼è¦æ±‚

### SYSTEM_PROMPT_HTML_GENERATION

**ç”¨é€”**ï¼šæŒ‡å¯¼ LLM ç”Ÿæˆè¯¦ç»†çš„ HTML æŠ¥å‘Šã€‚

**å…³é”®è¦æ±‚**ï¼š
1. **æ·±åº¦æ•´åˆ**ï¼šä¿ç•™è¯¦ç»†æ•°æ®ã€æ¡ˆä¾‹ã€å¼•ç”¨ï¼ˆä¸è¦æ€»ç»“ï¼Œè¦å±•å¼€ï¼‰
2. **å†…è”æ ·å¼**ï¼šæ‰€æœ‰ CSS å¿…é¡»å†™åœ¨ `<style>` æ ‡ç­¾å†…
3. **è¯¦ç»†å±•å¼€**ï¼šæ¯ä¸ªç« èŠ‚ 500-800 å­—ï¼Œ5-10 ä¸ªæ•°æ®ç‚¹
4. **å¼•ç”¨åŸæ–‡**ï¼šè‡³å°‘ 10 å¤„å¼•ç”¨ä¸‰ä¸ªå¼•æ“æŠ¥å‘Š
5. **è®ºå›åˆ†æ**ï¼šè‡³å°‘ 15 ä¸ªå…³é”®è®¨è®ºç‚¹
6. **æ•°æ®å¯è§†åŒ–**ï¼š3-5 ä¸ª Chart.js å›¾è¡¨
7. **ç›®æ ‡é•¿åº¦**ï¼š20,000+ å­—ç¬¦

**å†…å®¹å±•å¼€ç¤ºä¾‹**ï¼š
```
âŒ é”™è¯¯ï¼ˆè¿‡åº¦æ€»ç»“ï¼‰ï¼š"AI Agentæˆæœ¬é«˜ä¼ï¼Œå¼•å‘è´¨ç–‘ã€‚"

âœ… æ­£ç¡®ï¼ˆè¯¦ç»†å±•å¼€ï¼‰ï¼š"æ ¹æ®MediaEngineæŠ¥å‘Šï¼Œå•ä»»åŠ¡æˆæœ¬é«˜è¾¾28å…ƒäººæ°‘å¸ï¼Œ
å…¶ä¸­éšæ€§æˆæœ¬å æ¯”79%ã€‚å…·ä½“åŒ…æ‹¬ï¼šAPIè°ƒç”¨è´¹ç”¨ï¼ˆå¹³å‡æ¯æ¬¡0.8å…ƒï¼‰ã€äººå·¥å¹²é¢„
æˆæœ¬ï¼ˆæ¯ä»»åŠ¡1.2æ¬¡ï¼Œæ¯æ¬¡çº¦15å…ƒï¼‰ã€å¤±è´¥é‡è¯•æˆæœ¬ï¼ˆè¾¹ç¼˜åœºæ™¯æ•…éšœç‡68%ï¼‰ã€‚
QueryEngineæ•°æ®æ˜¾ç¤ºï¼Œä¼ä¸šå®é™…éƒ¨ç½²åå‘ç°ï¼Œå®£ä¼ çš„'é™æœ¬å¢æ•ˆ'æ‰¿è¯ºä¸ç°å®
å­˜åœ¨å·¨å¤§å·®è·ï¼Œå¯¼è‡´41.7%çš„è´Ÿé¢æƒ…ç»ªã€‚è®ºå›è®¨è®ºä¸­ï¼ŒæŸé‡‘èç§‘æŠ€å…¬å¸CTOè¡¨ç¤ºï¼š
'æˆ‘ä»¬åœ¨Q3çƒ§äº†3ä¸‡ç¾å…ƒæµ‹è¯•AI Agentï¼Œä½†ä»»åŠ¡æˆåŠŸç‡ä»…39.8%ï¼Œè¿œä½äºé¢„æœŸçš„80%ã€‚'"
```

---

## æ¨¡æ¿ç³»ç»Ÿ Templates

### å¯ç”¨æ¨¡æ¿

ReportEngine æä¾› **6 ç§é¢„è®¾æŠ¥å‘Šæ¨¡æ¿**ï¼š

1. **ä¼ä¸šå“ç‰Œå£°èª‰åˆ†ææŠ¥å‘Šæ¨¡æ¿**
   - é€‚ç”¨äºå“ç‰Œå½¢è±¡ã€å£°èª‰ç®¡ç†åˆ†æ
   - æˆ˜ç•¥æ€§ã€å…¨å±€æ€§åˆ†æ

2. **å¸‚åœºç«äº‰æ ¼å±€èˆ†æƒ…åˆ†ææŠ¥å‘Šæ¨¡æ¿**
   - é€‚ç”¨äºç«äº‰å¯¹æ‰‹åˆ†æ
   - å¯¹æ¯”ä¸æ´å¯Ÿ

3. **æ—¥å¸¸æˆ–å®šæœŸèˆ†æƒ…ç›‘æµ‹æŠ¥å‘Šæ¨¡æ¿**
   - é€‚ç”¨äºå¸¸æ€åŒ–ã€é«˜é¢‘æ¬¡ç›‘æµ‹
   - æ•°æ®å‘ˆç°ä¸åŠ¨æ€è¿½è¸ª

4. **ç‰¹å®šæ”¿ç­–æˆ–è¡Œä¸šåŠ¨æ€èˆ†æƒ…åˆ†ææŠ¥å‘Š**
   - é€‚ç”¨äºæ”¿ç­–å‘å¸ƒã€æ³•è§„å˜åŠ¨
   - æ·±åº¦è§£è¯»ã€é¢„åˆ¤è¶‹åŠ¿

5. **ç¤¾ä¼šå…¬å…±çƒ­ç‚¹äº‹ä»¶åˆ†ææŠ¥å‘Šæ¨¡æ¿**
   - é€‚ç”¨äºå…¬å…±çƒ­ç‚¹ã€æ–‡åŒ–ç°è±¡
   - æ´å¯Ÿç¤¾ä¼šå¿ƒæ€

6. **çªå‘äº‹ä»¶ä¸å±æœºå…¬å…³èˆ†æƒ…æŠ¥å‘Šæ¨¡æ¿**
   - é€‚ç”¨äºçªå‘è´Ÿé¢äº‹ä»¶
   - å¿«é€Ÿå“åº”ã€é£é™©è¯„ä¼°

### æ¨¡æ¿ç»“æ„ç¤ºä¾‹

ä»¥"ç‰¹å®šæ”¿ç­–æˆ–è¡Œä¸šåŠ¨æ€èˆ†æƒ…åˆ†ææŠ¥å‘Š"ä¸ºä¾‹ï¼š

```markdown
### ç‰¹å®šæ”¿ç­–/è¡Œä¸šåŠ¨æ€èˆ†æƒ…åˆ†ææŠ¥å‘Šæ¨¡æ¿

- 1.0 æ‘˜è¦ï¼šæ”¿ç­–/åŠ¨æ€çš„æ ¸å¿ƒå½±å“ä¸èˆ†è®ºååº”
  - 1.1 æ ¸å¿ƒå†…å®¹è§£è¯»
  - 1.2 èˆ†è®ºåœºæ ¸å¿ƒè§‚ç‚¹
  - 1.3 å…³é”®å½±å“é¢„åˆ¤
- 2.0 æ”¿ç­–/åŠ¨æ€èƒŒæ™¯ä¸ä¼ æ’­åˆ†æ
  - 2.1 å‘å¸ƒèƒŒæ™¯ä¸è§£è¯»
  - 2.2 å‘å±•ä¸å‘é…µæ—¶é—´çº¿
  - 2.3 ä¼ æ’­å£°é‡åˆ†æ
  - 2.4 æƒå¨è§£è¯»ä¸åª’ä½“å…³æ³¨ç‚¹
- 3.0 å…¬ä¼—æ€åº¦ä¸ç¤¾ä¼šæƒ…ç»ª
  - 3.1 èˆ†è®ºæƒ…ç»ªåˆ†å¸ƒ
  - 3.2 å„æ–¹è§‚ç‚¹èšç„¦
- 4.0 æ½œåœ¨å½±å“ä¸æœºé‡æŒ‘æˆ˜åˆ†æ
- 5.0 è¡Œä¸šæ ‡æ†æ¡ˆä¾‹ä¸ååº”
- 6.0 ç»“è®ºä¸åº”å¯¹å»ºè®®
```

---

**ä¸‹ä¸€ç¯‡ï¼š[ReportEngineæ™ºèƒ½å‹ç¼©æœºåˆ¶](./ReportEngineæ™ºèƒ½å‹ç¼©æœºåˆ¶.md)**

# ReportEngine è°ƒè¯•æ€»ç»“

## ğŸ“‹ ç›®å½•
- [é—®é¢˜å‘ç°](#é—®é¢˜å‘ç°)
- [è°ƒè¯•è¿‡ç¨‹](#è°ƒè¯•è¿‡ç¨‹)
- [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ)
- [ç»éªŒæ•™è®­](#ç»éªŒæ•™è®­)

---

## é—®é¢˜å‘ç°

### åˆå§‹é—®é¢˜

**ç°è±¡**ï¼šç”Ÿæˆçš„æœ€ç»ˆ HTML æŠ¥å‘Šéå¸¸ç®€å•ï¼Œåªæœ‰ 6,688 å­—ç¬¦ï¼Œè¿œä½äºé¢„æœŸã€‚

**ç”¨æˆ·åé¦ˆ**ï¼š
> "é‡æ–°è¿è¡Œåå¾—åˆ°çš„ final_report__20251113_214527.htmlï¼Œä¾ç„¶éå¸¸ç®€å•ã€‚è¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆï¼Ÿ"

**æ—¥å¿—åˆ†æ**ï¼š
```
è¾“å…¥æ•°æ®ç»Ÿè®¡ - query_engine: 13840 å­—ç¬¦, media_engine: 8513 å­—ç¬¦, 
insight_engine: 62199 å­—ç¬¦, forum_logs: 182388 å­—ç¬¦, 
æ€»è®¡: 279358 å­—ç¬¦ (çº¦ 186238 tokens)
âš ï¸ è¾“å…¥æ•°æ®è¶…è¿‡ qwen-long å•æ¡æ¶ˆæ¯çš„ 9000 tokens é™åˆ¶ï¼
LLMå“åº”é•¿åº¦: 6688 å­—ç¬¦, finish_reason: stop
```

**é—®é¢˜ç¡®è®¤**ï¼š
- âœ… è¾“å…¥æ•°æ®ï¼š266,940 å­—ç¬¦ï¼ˆçº¦ 186,238 tokensï¼‰
- âŒ LLM é™åˆ¶ï¼š9,000 tokens
- âŒ **è¶…å‡ºé™åˆ¶ 20.7 å€ï¼**
- âŒ LLM åªèƒ½çœ‹åˆ°å‰ 9,000 tokensï¼Œå¤§éƒ¨åˆ†å†…å®¹è¢«æˆªæ–­

---

## è°ƒè¯•è¿‡ç¨‹

### ç¬¬ä¸€é˜¶æ®µï¼šç†è§£ qwen-long çš„é™åˆ¶

#### é—®é¢˜ 1ï¼šmax_tokens å‚æ•°æœªç”Ÿæ•ˆ

**å‘ç°**ï¼š
- ä»£ç ä¸­è®¾ç½®äº† `max_tokens=24000`
- ä½† LLM è¾“å‡ºä»ç„¶å¾ˆçŸ­ï¼ˆ6,688 å­—ç¬¦ï¼‰

**åŸå› **ï¼š
- `max_tokens` æ§åˆ¶çš„æ˜¯**è¾“å‡ºé•¿åº¦**ï¼Œä¸æ˜¯è¾“å…¥é•¿åº¦
- çœŸæ­£çš„é—®é¢˜æ˜¯**è¾“å…¥è¢«æˆªæ–­**

#### é—®é¢˜ 2ï¼š9,000 tokens é™åˆ¶çš„æ¥æº

**ç”¨æˆ·è´¨ç–‘**ï¼š
> "æ–‡æ¡£ä¸Š qwen-long çš„æœ€å¤§è¾“å…¥æ˜¯ 10,000,000 tokenï¼Œä¸æ˜¯ 9,000ï¼Œ9,000 ä»å“ªé‡Œçœ‹æ¥çš„ï¼Ÿ"

**è°ƒæŸ¥ç»“æœ**ï¼š
æ ¹æ®[é˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£](https://help.aliyun.com/zh/model-studio/user-guide/long-context-qwen-long)ï¼š

> **API è¾“å…¥é™åˆ¶**ï¼š
> - é€šè¿‡ **file-id** å¼•ç”¨æ—¶ï¼Œå•æ¬¡è¯·æ±‚æœ€å¤šå¼•ç”¨ 100 ä¸ªæ–‡ä»¶ã€‚æ€»ä¸Šä¸‹æ–‡é•¿åº¦ä¸Šé™ä¸º **1000 ä¸‡ Token**ã€‚
> - **ç›´æ¥åœ¨ user æˆ– system æ¶ˆæ¯ä¸­è¾“å…¥çº¯æ–‡æœ¬æ—¶ï¼Œå•æ¡æ¶ˆæ¯å†…å®¹ï¼ˆé file-idï¼‰é™åˆ¶åœ¨ 9,000 Token ä»¥å†…ã€‚**

**ç»“è®º**ï¼š
- âœ… 1000 ä¸‡ tokens æ˜¯ä½¿ç”¨ file-id æ–¹å¼çš„é™åˆ¶
- âœ… 9,000 tokens æ˜¯çº¯æ–‡æœ¬æ–¹å¼çš„é™åˆ¶
- âœ… æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯çº¯æ–‡æœ¬æ–¹å¼ï¼Œæ‰€ä»¥å— 9,000 tokens é™åˆ¶

### ç¬¬äºŒé˜¶æ®µï¼šè®¾è®¡å‹ç¼©ç­–ç•¥

#### å°è¯• 1ï¼šæç¤ºè¯ä¼˜åŒ–

**ä¿®æ”¹å†…å®¹**ï¼š
```python
# æ·»åŠ æ˜ç¡®çš„è¦æ±‚
- **å¿…é¡»è¯¦ç»†å±•å¼€å†…å®¹**ï¼šæ¯ä¸ªç« èŠ‚éƒ½è¦åŒ…å«å…·ä½“æ•°æ®ã€æ¡ˆä¾‹ã€åˆ†æï¼Œä¸è¦åªå†™æ‘˜è¦
- **ç¦æ­¢è¿‡åº¦æ€»ç»“**ï¼šä¸è¦å°†è¯¦ç»†å†…å®¹å‹ç¼©æˆç®€çŸ­æ‘˜è¦ï¼Œè¦å±•å¼€å™è¿°

# æ·»åŠ å†…å®¹å±•å¼€ç¤ºä¾‹
âŒ é”™è¯¯ï¼ˆè¿‡åº¦æ€»ç»“ï¼‰ï¼š"AI Agentæˆæœ¬é«˜ä¼ï¼Œå¼•å‘è´¨ç–‘ã€‚"
âœ… æ­£ç¡®ï¼ˆè¯¦ç»†å±•å¼€ï¼‰ï¼š"æ ¹æ®MediaEngineæŠ¥å‘Šï¼Œå•ä»»åŠ¡æˆæœ¬é«˜è¾¾28å…ƒäººæ°‘å¸..."
```

**æ•ˆæœ**ï¼š
- âš ï¸ æç¤ºè¯ä¼˜åŒ–æœ‰å¸®åŠ©ï¼Œä½†æ— æ³•è§£å†³æ ¹æœ¬é—®é¢˜
- âŒ è¾“å…¥ä»ç„¶è¢«æˆªæ–­ï¼ŒLLM çœ‹ä¸åˆ°å®Œæ•´æ•°æ®

#### å°è¯• 2ï¼šå¢åŠ  max_tokens

**ä¿®æ”¹å†…å®¹**ï¼š
```python
# ä» 16000 å¢åŠ åˆ° 24000
response = self.llm_client.invoke(
    SYSTEM_PROMPT_HTML_GENERATION,
    message,
    max_tokens=24000  # qwen-long æ”¯æŒ 32768 tokens è¾“å‡º
)
```

**æ•ˆæœ**ï¼š
- âœ… è¾“å‡ºé•¿åº¦æœ‰æ‰€å¢åŠ ï¼ˆä» 3,889 â†’ 8,422 å­—ç¬¦ï¼‰
- âŒ ä»ç„¶è¿œä½äºé¢„æœŸï¼ˆç›®æ ‡ 20,000+ å­—ç¬¦ï¼‰
- âŒ æ ¹æœ¬é—®é¢˜æœªè§£å†³ï¼šè¾“å…¥è¢«æˆªæ–­

#### å°è¯• 3ï¼šæ™ºèƒ½å‹ç¼©è¾“å…¥æ•°æ®

**è®¾è®¡æ€è·¯**ï¼š
1. ä¿ç•™æ¯ä¸ªæŠ¥å‘Šçš„å‰ N ä¸ªå­—ç¬¦ï¼ˆå…³é”®ä¿¡æ¯é€šå¸¸åœ¨å‰é¢ï¼‰
2. æ ¹æ®é‡è¦æ€§åˆ†é…ä¸åŒçš„å­—ç¬¦é…é¢
3. ç›®æ ‡ï¼šå‹ç¼©åˆ° 13,000 å­—ç¬¦ï¼ˆçº¦ 8,666 tokensï¼‰

**å®ç°ä»£ç **ï¼š
```python
# æ™ºèƒ½å‹ç¼©ï¼šå¦‚æœè¾“å…¥æ•°æ®è¿‡å¤§ï¼Œè¿›è¡Œå‹ç¼©
max_total_chars = 13000

# ä¸ºæ¯ä¸ªéƒ¨åˆ†åˆ†é…å­—ç¬¦é…é¢
query_quota = min(len(query_report), 4000)
media_quota = min(len(media_report), 4000)
insight_quota = min(len(insight_report), 3000)
forum_quota = min(len(forum_logs), 2000)

# å¦‚æœæ€»é•¿åº¦è¶…è¿‡é™åˆ¶ï¼Œè¿›è¡Œæˆªæ–­
if original_total > max_total_chars:
    logger.warning(f"âš ï¸ è¾“å…¥æ•°æ®è¿‡å¤§ï¼ˆ{original_total} å­—ç¬¦ï¼‰ï¼Œè¿›è¡Œæ™ºèƒ½å‹ç¼©...")
    query_report = query_report[:query_quota]
    media_report = media_report[:media_quota]
    insight_report = insight_report[:insight_quota]
    forum_logs = forum_logs[:forum_quota]
```

**æ•ˆæœ**ï¼š
- âœ… è¾“å…¥ä» 266,940 å­—ç¬¦ â†’ 13,000 å­—ç¬¦
- âœ… ä¼°ç®— tokens ä» 177,960 â†’ 8,666ï¼ˆç¬¦åˆé™åˆ¶ï¼‰
- âœ… **LLM è¾“å‡ºä» 6,688 å­—ç¬¦ â†’ 20,720 å­—ç¬¦**
- âœ… **æŠ¥å‘Šè´¨é‡æ˜¾è‘—æå‡ï¼**

### ç¬¬ä¸‰é˜¶æ®µï¼šä»£ç ä¸¢å¤±é—®é¢˜

#### é—®é¢˜ï¼šå‹ç¼©é€»è¾‘æœªæ‰§è¡Œ

**ç°è±¡**ï¼š
```
è¾“å…¥æ•°æ®ç»Ÿè®¡ - query_engine: 13840 å­—ç¬¦, media_engine: 8513 å­—ç¬¦, 
insight_engine: 62199 å­—ç¬¦, forum_logs: 182388 å­—ç¬¦, 
æ€»è®¡: 279358 å­—ç¬¦ (çº¦ 186238 tokens)
âš ï¸ è¾“å…¥æ•°æ®è¶…è¿‡ qwen-long å•æ¡æ¶ˆæ¯çš„ 9000 tokens é™åˆ¶ï¼
```

**é—®é¢˜åˆ†æ**ï¼š
- âŒ æ²¡æœ‰çœ‹åˆ°"åŸå§‹è¾“å…¥æ•°æ®"æ—¥å¿—
- âŒ æ²¡æœ‰çœ‹åˆ°"å‹ç¼©å®Œæˆ"æ—¥å¿—
- âŒ å‹ç¼©é€»è¾‘æ²¡æœ‰æ‰§è¡Œ

**åŸå› **ï¼š
- ä»£ç è¢«è¦†ç›–äº†ï¼Œä¹‹å‰æ·»åŠ çš„å‹ç¼©é€»è¾‘ä¸¢å¤±
- éœ€è¦é‡æ–°æ·»åŠ 

**è§£å†³**ï¼š
- é‡æ–°æ·»åŠ å®Œæ•´çš„å‹ç¼©é€»è¾‘
- æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•

---

## è§£å†³æ–¹æ¡ˆ

### æœ€ç»ˆæ–¹æ¡ˆï¼šæ™ºèƒ½å‹ç¼© + æç¤ºè¯ä¼˜åŒ–

#### 1. æ™ºèƒ½å‹ç¼©è¾“å…¥æ•°æ®

**ä½ç½®**ï¼š`ReportEngine/nodes/html_generation_node.py`

**å…³é”®ä»£ç **ï¼š
```python
# è®°å½•åŸå§‹æ•°æ®å¤§å°
original_total = len(query_report) + len(media_report) + \
                 len(insight_report) + len(forum_logs)
logger.info(f"åŸå§‹è¾“å…¥æ•°æ® - query: {len(query_report)}, "
           f"media: {len(media_report)}, "
           f"insight: {len(insight_report)}, "
           f"forum: {len(forum_logs)}, "
           f"æ€»è®¡: {original_total} å­—ç¬¦")

# æ™ºèƒ½å‹ç¼©
if original_total > 13000:
    logger.warning(f"âš ï¸ è¾“å…¥æ•°æ®è¿‡å¤§ï¼ˆ{original_total} å­—ç¬¦ï¼‰ï¼Œè¿›è¡Œæ™ºèƒ½å‹ç¼©...")
    query_report = query_report[:4000]
    media_report = media_report[:4000]
    insight_report = insight_report[:3000]
    forum_logs = forum_logs[:2000]
    compressed_total = len(query_report) + len(media_report) + \
                      len(insight_report) + len(forum_logs)
    logger.info(f"âœ“ å‹ç¼©å®Œæˆ - æ€»è®¡: {compressed_total} å­—ç¬¦"
               f"ï¼ˆå‹ç¼©ç‡: {compressed_total/original_total*100:.1f}%ï¼‰")
```

#### 2. ä¼˜åŒ–æç¤ºè¯

**ä½ç½®**ï¼š`ReportEngine/prompts/prompts.py`

**å…³é”®ä¿®æ”¹**ï¼š
```python
**å…³é”®è¦æ±‚ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰ï¼š**
- **å¿…é¡»ä½¿ç”¨å†…è”æ ·å¼**ï¼šæ‰€æœ‰CSSå¿…é¡»å†™åœ¨<style>æ ‡ç­¾å†…
- **å¿…é¡»è¯¦ç»†å±•å¼€å†…å®¹**ï¼šæ¯ä¸ªç« èŠ‚éƒ½è¦åŒ…å«å…·ä½“æ•°æ®ã€æ¡ˆä¾‹ã€åˆ†æï¼Œä¸è¦åªå†™æ‘˜è¦
- **å¿…é¡»å¼•ç”¨åŸå§‹æŠ¥å‘Š**ï¼šç›´æ¥å¼•ç”¨ä¸‰ä¸ªå¼•æ“æŠ¥å‘Šä¸­çš„å…³é”®æ®µè½å’Œæ•°æ®ï¼Œä¿ç•™åŸæ–‡ç»†èŠ‚
- **ç¦æ­¢è¿‡åº¦æ€»ç»“**ï¼šä¸è¦å°†è¯¦ç»†å†…å®¹å‹ç¼©æˆç®€çŸ­æ‘˜è¦ï¼Œè¦å±•å¼€å™è¿°

**å†…å®¹è¯¦ç»†ç¨‹åº¦è¦æ±‚ï¼ˆå¿…é¡»è¾¾åˆ°ï¼‰ï¼š**
- æ¯ä¸ªä¸»è¦ç« èŠ‚è‡³å°‘åŒ…å« 500-800 å­—çš„è¯¦ç»†åˆ†æ
- æ¯ä¸ªç« èŠ‚è‡³å°‘åŒ…å« 5-10 ä¸ªå…·ä½“æ•°æ®ç‚¹ï¼ˆæ•°å­—ã€ç™¾åˆ†æ¯”ã€æ¡ˆä¾‹ï¼‰
- ç›´æ¥å¼•ç”¨ä¸‰ä¸ªå¼•æ“æŠ¥å‘Šä¸­çš„å…³é”®æ®µè½ï¼ˆè‡³å°‘ 10 å¤„å¼•ç”¨ï¼Œä¿ç•™åŸæ–‡ï¼‰
- ä»è®ºå›æ—¥å¿—ä¸­æå–è‡³å°‘ 15 ä¸ªå…³é”®è®¨è®ºç‚¹ï¼Œå±•ç¤ºå…·ä½“å¯¹è¯å†…å®¹
- æ€»ä½“HTMLæ–‡ä»¶å¤§å°åº”è¾¾åˆ° 20,000 å­—ç¬¦ä»¥ä¸Šï¼ˆä¸å«ç©ºæ ¼å’Œæ¢è¡Œï¼‰
```

#### 3. å¢åŠ  max_tokens

**ä½ç½®**ï¼š`ReportEngine/llms/base.py` å’Œ `html_generation_node.py`

**å…³é”®ä»£ç **ï¼š
```python
# base.py - é»˜è®¤å€¼
if "max_tokens" not in extra_params:
    extra_params["max_tokens"] = 16000

# html_generation_node.py - æ˜¾å¼è®¾ç½®
response = self.llm_client.invoke(
    SYSTEM_PROMPT_HTML_GENERATION,
    message,
    max_tokens=24000  # qwen-long çš„å¤§è¾“å‡º
)
```

#### 4. æ·»åŠ è¯¦ç»†æ—¥å¿—

**å…³é”®æ—¥å¿—**ï¼š
```python
# è¾“å…¥æ•°æ®ç»Ÿè®¡
logger.info(f"åŸå§‹è¾“å…¥æ•°æ® - query: {len(query_report)}, ...")
logger.warning(f"âš ï¸ è¾“å…¥æ•°æ®è¿‡å¤§ï¼ˆ{original_total} å­—ç¬¦ï¼‰ï¼Œè¿›è¡Œæ™ºèƒ½å‹ç¼©...")
logger.info(f"âœ“ å‹ç¼©å®Œæˆ - æ€»è®¡: {compressed_total} å­—ç¬¦...")
logger.info(f"æœ€ç»ˆè¾“å…¥æ•°æ®ï¼ˆå«JSONæ ¼å¼ï¼‰: {total_chars} å­—ç¬¦ (çº¦ {int(estimated_tokens)} tokens)")

# LLM è°ƒç”¨å‚æ•°
logger.info(f"LLMè°ƒç”¨å‚æ•° - max_tokens: {extra_params.get('max_tokens')}, model: {self.model_name}")

# LLM å“åº”
logger.info(f"LLMå“åº”é•¿åº¦: {len(content)} å­—ç¬¦, finish_reason: {response.choices[0].finish_reason}")
```

---

## ç»éªŒæ•™è®­

### 1. ç†è§£ LLM çš„é™åˆ¶

**æ•™è®­**ï¼š
- âœ… ä¸åŒçš„è¾“å…¥æ–¹å¼æœ‰ä¸åŒçš„é™åˆ¶
- âœ… çº¯æ–‡æœ¬æ–¹å¼ï¼š9,000 tokens
- âœ… file-id æ–¹å¼ï¼š1000 ä¸‡ tokens
- âœ… éœ€è¦ä»”ç»†é˜…è¯»å®˜æ–¹æ–‡æ¡£

**å»ºè®®**ï¼š
- åœ¨è®¾è®¡ç³»ç»Ÿæ—¶ï¼Œæå‰äº†è§£ LLM çš„å„ç§é™åˆ¶
- è€ƒè™‘ä¸åŒçš„è¾“å…¥æ–¹å¼åŠå…¶æƒè¡¡

### 2. æ—¥å¿—çš„é‡è¦æ€§

**æ•™è®­**ï¼š
- âœ… è¯¦ç»†çš„æ—¥å¿—å¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜
- âœ… è®°å½•è¾“å…¥å¤§å°ã€å‹ç¼©è¿‡ç¨‹ã€LLM å“åº”
- âœ… æ—¥å¿—åº”è¯¥åŒ…å«å…³é”®æŒ‡æ ‡ï¼ˆå­—ç¬¦æ•°ã€tokensã€å‹ç¼©ç‡ï¼‰

**å»ºè®®**ï¼š
- åœ¨å…³é”®æ­¥éª¤æ·»åŠ æ—¥å¿—
- æ—¥å¿—åº”è¯¥æ¸…æ™°ã€ç»“æ„åŒ–
- ä½¿ç”¨ä¸åŒçš„æ—¥å¿—çº§åˆ«ï¼ˆINFOã€WARNINGã€ERRORï¼‰

### 3. æç¤ºè¯å·¥ç¨‹çš„å±€é™æ€§

**æ•™è®­**ï¼š
- âš ï¸ æç¤ºè¯ä¼˜åŒ–æœ‰å¸®åŠ©ï¼Œä½†æ— æ³•è§£å†³æ ¹æœ¬é—®é¢˜
- âš ï¸ å¦‚æœè¾“å…¥è¢«æˆªæ–­ï¼Œå†å¥½çš„æç¤ºè¯ä¹Ÿæ— æµäºäº‹
- âœ… éœ€è¦å…ˆè§£å†³è¾“å…¥é—®é¢˜ï¼Œå†ä¼˜åŒ–æç¤ºè¯

**å»ºè®®**ï¼š
- å…ˆç¡®ä¿ LLM èƒ½çœ‹åˆ°å®Œæ•´è¾“å…¥
- å†é€šè¿‡æç¤ºè¯ä¼˜åŒ–è¾“å‡ºè´¨é‡

### 4. ä»£ç ç‰ˆæœ¬ç®¡ç†

**æ•™è®­**ï¼š
- âŒ ä»£ç è¢«è¦†ç›–ï¼Œå‹ç¼©é€»è¾‘ä¸¢å¤±
- âŒ å¯¼è‡´é—®é¢˜é‡ç°

**å»ºè®®**ï¼š
- ä½¿ç”¨ Git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶
- é‡è¦ä¿®æ”¹åŠæ—¶æäº¤
- æ·»åŠ å•å…ƒæµ‹è¯•ç¡®ä¿åŠŸèƒ½æ­£å¸¸

### 5. å‹ç¼©ç­–ç•¥çš„è®¾è®¡

**æ•™è®­**ï¼š
- âœ… ä¿ç•™å‰ N ä¸ªå­—ç¬¦æ˜¯ç®€å•æœ‰æ•ˆçš„ç­–ç•¥
- âœ… å…³é”®ä¿¡æ¯é€šå¸¸åœ¨æŠ¥å‘Šå‰é¢
- âœ… æ ¹æ®é‡è¦æ€§åˆ†é…ä¸åŒé…é¢

**å»ºè®®**ï¼š
- åˆ†ææ•°æ®ç‰¹å¾ï¼Œè®¾è®¡åˆç†çš„å‹ç¼©ç­–ç•¥
- ç›‘æ§å‹ç¼©åçš„æ•ˆæœï¼ŒåŠæ—¶è°ƒæ•´é…é¢
- è€ƒè™‘æ›´é«˜çº§çš„å‹ç¼©æ–¹æ³•ï¼ˆå¦‚ LLM æ‘˜è¦ï¼‰

---

## æœ€ç»ˆæ•ˆæœ

### å¯¹æ¯”æ•°æ®

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | æ”¹å–„ |
|------|--------|--------|------|
| **è¾“å…¥å¤§å°** | 266,940 å­—ç¬¦ | 13,000 å­—ç¬¦ | â†“ 95.1% |
| **æ˜¯å¦è¶…é™** | âŒ è¶…å‡º 19.8 å€ | âœ… ç¬¦åˆé™åˆ¶ | - |
| **LLM å“åº”** | 6,688 å­—ç¬¦ | 20,720 å­—ç¬¦ | â†‘ 210% |
| **æŠ¥å‘Šè´¨é‡** | âŒ ç®€å• | âœ… è¯¦ç»† | - |
| **ç”Ÿæˆæ—¶é—´** | 116 ç§’ | 184 ç§’ | â†‘ 58% |

### ç”¨æˆ·åé¦ˆ

**ä¿®å¤å‰**ï¼š
> "è¿˜æ˜¯éå¸¸ç®€å•"

**ä¿®å¤å**ï¼š
> "è¿™å›ç”Ÿæˆçš„æŠ¥å‘Šå¯ä»¥äº†"

---

## æ€»ç»“

### å…³é”®æˆæœ

âœ… **æˆåŠŸè§£å†³è¾“å…¥è¶…é™é—®é¢˜**
- æ™ºèƒ½å‹ç¼©è¾“å…¥æ•°æ®
- ä» 177,960 tokens â†’ 8,666 tokens

âœ… **æ˜¾è‘—æå‡æŠ¥å‘Šè´¨é‡**
- ä» 6,688 å­—ç¬¦ â†’ 20,720 å­—ç¬¦
- æŠ¥å‘Šå†…å®¹è¯¦ç»†ã€æ•°æ®ä¸°å¯Œ

âœ… **å»ºç«‹å®Œå–„çš„è°ƒè¯•æœºåˆ¶**
- è¯¦ç»†çš„æ—¥å¿—è®°å½•
- æ¸…æ™°çš„é—®é¢˜å®šä½æµç¨‹

### æŠ€æœ¯äº®ç‚¹

1. **æ™ºèƒ½å‹ç¼©æœºåˆ¶**ï¼šæ ¹æ®é‡è¦æ€§åˆ†é…é…é¢
2. **æç¤ºè¯ä¼˜åŒ–**ï¼šæ˜ç¡®è¦æ±‚å’Œç¤ºä¾‹
3. **è¯¦ç»†æ—¥å¿—**ï¼šæ–¹ä¾¿è°ƒè¯•å’Œç›‘æ§
4. **çµæ´»å¯è°ƒ**ï¼šé…é¢å¯ä»¥æ ¹æ®éœ€æ±‚è°ƒæ•´

### æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **ä½¿ç”¨ file-id æ–¹å¼**ï¼šæ”¯æŒå®Œæ•´è¾“å…¥ï¼ˆéœ€è¦ä»£ç æ”¹åŠ¨ï¼‰
2. **LLM æ‘˜è¦å‹ç¼©**ï¼šä½¿ç”¨ LLM å¯¹é•¿æ–‡æœ¬è¿›è¡Œæ™ºèƒ½æ‘˜è¦
3. **åˆ†æ®µç”Ÿæˆ**ï¼šå…ˆç”Ÿæˆå„éƒ¨åˆ†ï¼Œå†æ•´åˆ
4. **ç¼“å­˜æœºåˆ¶**ï¼šé¿å…é‡å¤å‹ç¼©ç›¸åŒçš„è¾“å…¥

---

**ç›¸å…³æ–‡æ¡£**ï¼š
- [ReportEngineæ¶æ„è®¾è®¡](./ReportEngineæ¶æ„è®¾è®¡.md)
- [ReportEngineæ ¸å¿ƒç»„ä»¶](./ReportEngineæ ¸å¿ƒç»„ä»¶.md)
- [ReportEngineæ™ºèƒ½å‹ç¼©æœºåˆ¶](./ReportEngineæ™ºèƒ½å‹ç¼©æœºåˆ¶.md)

---

# ReportEngine æ–‡ä»¶é€‰æ‹©æœºåˆ¶

## ğŸ“‹ æ ¸å¿ƒé—®é¢˜

**ç”¨æˆ·æ‹…å¿ƒ**ï¼šç›®å½•ä¸­æœ‰7ä¸ªæ–‡ä»¶ï¼ŒReportEngineä¼šåŒæ—¶å‚è€ƒè¿™7ä¸ªæ–‡ä»¶å—ï¼Ÿè¿™äº›æ–‡ä»¶å¯èƒ½æ˜¯ä¸åŒçš„åˆ†æä¸»é¢˜ã€‚

**ç­”æ¡ˆ**ï¼š**ä¸ä¼šï¼ReportEngineåªä½¿ç”¨æ¯ä¸ªå¼•æ“ç›®å½•ä¸­ä¿®æ”¹æ—¶é—´æœ€æ–°çš„1ä¸ªæ–‡ä»¶ã€‚**

---

## ğŸ” å·¥ä½œæµç¨‹è¯¦è§£

### 1. æ–‡ä»¶æ£€æŸ¥é˜¶æ®µï¼ˆåˆ¤æ–­æ˜¯å¦å¯ä»¥ç”ŸæˆæŠ¥å‘Šï¼‰

```python
# ä½ç½®ï¼šReportEngine/agent.py - check_input_files_selective()

# æ£€æŸ¥ç›®å½•ä¸­çš„æ–‡ä»¶æ•°é‡
media_engine_streamlit_reports/
â”œâ”€â”€ deep_search_report_æ­¦æ±‰å¤§å­¦_20250825.md          â† æ—§ä¸»é¢˜1
â”œâ”€â”€ deep_search_report_æ­¦æ±‰å¤§å­¦_20250825.md          â† æ—§ä¸»é¢˜2  
â”œâ”€â”€ deep_search_report_AI_Agentæµç¨‹è‡ªåŠ¨åŒ–_20251114.md â† æ–°ä¸»é¢˜ï¼ˆåˆšåˆ†æçš„ï¼‰
â”œâ”€â”€ deep_search_report_AI_Agentæµç¨‹è‡ªåŠ¨åŒ–_20251113.md â† æ—§ä¸»é¢˜3
â””â”€â”€ ... å…±7ä¸ªæ–‡ä»¶

æ£€æŸ¥é€»è¾‘ï¼š
- ç»Ÿè®¡ç›®å½•ä¸­çš„æ–‡ä»¶æ€»æ•°ï¼š7ä¸ª
- å¯¹æ¯”åŸºå‡†æ–‡ä»¶æ•°ï¼š6ä¸ª
- åˆ¤æ–­æ˜¯å¦æœ‰æ–°å¢ï¼š7 - 6 = 1ä¸ªæ–°å¢ âœ“
- ç»“è®ºï¼šæœ‰æ–°æ–‡ä»¶ï¼Œå¯ä»¥ç”ŸæˆæŠ¥å‘Š
```

### 2. æ–‡ä»¶é€‰æ‹©é˜¶æ®µï¼ˆé€‰æ‹©è¦ä½¿ç”¨çš„æ–‡ä»¶ï¼‰

```python
# ä½ç½®ï¼šReportEngine/agent.py - get_latest_files()

def get_latest_files(self, directories: Dict[str, str]) -> Dict[str, str]:
    """è·å–æ¯ä¸ªç›®å½•çš„æœ€æ–°æ–‡ä»¶"""
    latest_files = {}
    
    for engine, directory in directories.items():
        if os.path.exists(directory):
            md_files = [f for f in os.listdir(directory) if f.endswith(".md")]
            if md_files:
                # å…³é”®ï¼šä½¿ç”¨ max() å’Œæ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼Œåªå–æœ€æ–°çš„1ä¸ª
                latest_file = max(
                    md_files,
                    key=lambda x: os.path.getmtime(os.path.join(directory, x)),
                )
                latest_files[engine] = os.path.join(directory, latest_file)
    
    return latest_files

# ç»“æœï¼š
# {
#     'media': 'media_engine_streamlit_reports/deep_search_report_AI_Agentæµç¨‹è‡ªåŠ¨åŒ–_20251114_095854.md',
#     'insight': 'insight_engine_streamlit_reports/æœ€æ–°æ–‡ä»¶.md',
#     'query': 'query_engine_streamlit_reports/æœ€æ–°æ–‡ä»¶.md'
# }
```

**å…³é”®ç‚¹**ï¼š
- âœ… ä½¿ç”¨ `os.path.getmtime()` è·å–æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´
- âœ… ä½¿ç”¨ `max()` å‡½æ•°æ‰¾åˆ°ä¿®æ”¹æ—¶é—´æœ€æ–°çš„æ–‡ä»¶
- âœ… **æ¯ä¸ªå¼•æ“ç›®å½•åªè¿”å›1ä¸ªæœ€æ–°æ–‡ä»¶**

### 3. æŠ¥å‘Šç”Ÿæˆé˜¶æ®µï¼ˆåŠ è½½æ–‡ä»¶å†…å®¹ï¼‰

```python
# ä½ç½®ï¼šReportEngine/agent.py - load_input_files()

def load_input_files(self, file_paths: Dict[str, str]) -> Dict[str, Any]:
    """åŠ è½½è¾“å…¥æ–‡ä»¶å†…å®¹"""
    content = {"reports": [], "forum_logs": ""}
    
    # åŠ è½½æŠ¥å‘Šæ–‡ä»¶
    engines = ["query", "media", "insight"]
    for engine in engines:
        if engine in file_paths:  # file_paths ä¸­æ¯ä¸ªå¼•æ“åªæœ‰1ä¸ªæ–‡ä»¶è·¯å¾„
            try:
                with open(file_paths[engine], "r", encoding="utf-8") as f:
                    report_content = f.read()
                content["reports"].append(report_content)
                logger.info(f"å·²åŠ è½½ {engine} æŠ¥å‘Š: {len(report_content)} å­—ç¬¦")
            except Exception as e:
                logger.exception(f"åŠ è½½ {engine} æŠ¥å‘Šå¤±è´¥: {str(e)}")
                content["reports"].append("")
    
    return content

# ç»“æœï¼š
# content = {
#     'reports': [
#         'Queryå¼•æ“çš„æœ€æ–°æŠ¥å‘Šå†…å®¹...',
#         'Mediaå¼•æ“çš„æœ€æ–°æŠ¥å‘Šå†…å®¹...',  â† åªæœ‰è¿™1ä¸ªMediaæ–‡ä»¶çš„å†…å®¹
#         'Insightå¼•æ“çš„æœ€æ–°æŠ¥å‘Šå†…å®¹...'
#     ],
#     'forum_logs': 'è®ºå›æ—¥å¿—å†…å®¹...'
# }
```

---

## ğŸ“Š å®Œæ•´ç¤ºä¾‹

### åœºæ™¯ï¼šåˆ†æ"AI Agentåœ¨æµç¨‹è‡ªåŠ¨åŒ–èƒ½åŠ›ä¸Šçš„æœ€æ–°è¿›å±•"

#### æ­¥éª¤1ï¼šç”¨æˆ·ç‚¹å‡»"å¼€å§‹"æœç´¢

```
å¯ç”¨çš„å¼•æ“ï¼šMedia Engine
æŸ¥è¯¢ä¸»é¢˜ï¼šAI Agentåœ¨æµç¨‹è‡ªåŠ¨åŒ–èƒ½åŠ›ä¸Šçš„æœ€æ–°è¿›å±•
```

#### æ­¥éª¤2ï¼šMedia Engine å·¥ä½œå¹¶ç”ŸæˆæŠ¥å‘Š

```
ç”Ÿæˆæ–‡ä»¶ï¼š
media_engine_streamlit_reports/deep_search_report_AI_Agentæµç¨‹è‡ªåŠ¨åŒ–_20251114_095854.md
ä¿®æ”¹æ—¶é—´ï¼š2025-11-14 09:58:54
```

#### æ­¥éª¤3ï¼šReportEngine æ£€æŸ¥çŠ¶æ€

```
æ£€æŸ¥ç»“æœï¼š
- ç›®å½•æ–‡ä»¶æ€»æ•°ï¼š7ä¸ª
- åŸºå‡†æ–‡ä»¶æ•°ï¼š6ä¸ª
- æ–°å¢æ–‡ä»¶æ•°ï¼š1ä¸ª âœ“
- çŠ¶æ€ï¼šå¯ä»¥ç”ŸæˆæŠ¥å‘Š
```

#### æ­¥éª¤4ï¼šReportEngine é€‰æ‹©æ–‡ä»¶

```
æ‰«ææ‰€æœ‰ .md æ–‡ä»¶ï¼š
1. deep_search_report_æ­¦æ±‰å¤§å­¦_20250825.md          (ä¿®æ”¹æ—¶é—´: 2025-08-25)
2. deep_search_report_æ­¦æ±‰å¤§å­¦_20250825.md          (ä¿®æ”¹æ—¶é—´: 2025-08-25)
3. deep_search_report_AI_Agentæµç¨‹è‡ªåŠ¨åŒ–_20251113.md (ä¿®æ”¹æ—¶é—´: 2025-11-13)
4. deep_search_report_AI_Agentæµç¨‹è‡ªåŠ¨åŒ–_20251114.md (ä¿®æ”¹æ—¶é—´: 2025-11-14 09:58:54) â† æœ€æ–°ï¼

é€‰æ‹©ç»“æœï¼š
åªä½¿ç”¨ deep_search_report_AI_Agentæµç¨‹è‡ªåŠ¨åŒ–_20251114.md
```

#### æ­¥éª¤5ï¼šç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š

```
è¾“å…¥å†…å®¹ï¼š
- MediaæŠ¥å‘Šï¼šdeep_search_report_AI_Agentæµç¨‹è‡ªåŠ¨åŒ–_20251114.md çš„å†…å®¹
- Forumæ—¥å¿—ï¼šlogs/forum.log çš„å†…å®¹

è¾“å‡ºï¼š
final_reports/final_report_AI_Agentæµç¨‹è‡ªåŠ¨åŒ–_20251114.html
```

---

## âœ… æ ¸å¿ƒç»“è®º

### æ–‡ä»¶é€‰æ‹©æœºåˆ¶ä¿è¯äº†ä¸»é¢˜ä¸€è‡´æ€§

1. **ReportEngine åªä½¿ç”¨æœ€æ–°çš„1ä¸ªæ–‡ä»¶**
   - é€šè¿‡æ–‡ä»¶ä¿®æ”¹æ—¶é—´åˆ¤æ–­
   - è‡ªåŠ¨å¿½ç•¥æ—§çš„åˆ†æä¸»é¢˜

2. **ä¸ä¼šæ··æ·†ä¸åŒçš„åˆ†æä¸»é¢˜**
   - æ¯æ¬¡æœç´¢ç”Ÿæˆçš„æ–°æ–‡ä»¶éƒ½æœ‰æœ€æ–°çš„æ—¶é—´æˆ³
   - æ—§ä¸»é¢˜çš„æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨å¿½ç•¥

3. **æ”¹è¿›åçš„æç¤ºä¿¡æ¯æ›´æ¸…æ™°**
   ```
   ä¿®æ”¹å‰ï¼š
   æ‰¾åˆ°æ–‡ä»¶: media: 7ä¸ªæ–‡ä»¶ (æ–°å¢1ä¸ª)
   
   ä¿®æ”¹åï¼š
   æ‰¾åˆ°æ–‡ä»¶: media: ç›®å½•æœ‰7ä¸ªæ–‡ä»¶ (æ–°å¢1ä¸ª)ï¼Œå°†ä½¿ç”¨æœ€æ–°æ–‡ä»¶: deep_search_report_AI_Agentæµç¨‹è‡ªåŠ¨åŒ–_20251114_095854.md
   ```

### ä¸ºä»€ä¹ˆè¦ä¿ç•™æ—§æ–‡ä»¶ï¼Ÿ

è™½ç„¶ ReportEngine åªä½¿ç”¨æœ€æ–°æ–‡ä»¶ï¼Œä½†ä¿ç•™å†å²æ–‡ä»¶æœ‰ä»¥ä¸‹å¥½å¤„ï¼š

1. **å†å²è®°å½•**ï¼šå¯ä»¥æŸ¥çœ‹ä¹‹å‰çš„åˆ†æç»“æœ
2. **å¯¹æ¯”åˆ†æ**ï¼šå¯ä»¥æ‰‹åŠ¨å¯¹æ¯”ä¸åŒæ—¶é—´çš„åˆ†æ
3. **æ•°æ®å¤‡ä»½**ï¼šé˜²æ­¢æ„å¤–åˆ é™¤é‡è¦åˆ†æç»“æœ
4. **è°ƒè¯•è¿½æº¯**ï¼šå‡ºé—®é¢˜æ—¶å¯ä»¥æŸ¥çœ‹å†å²æ–‡ä»¶

### å¦‚æœæƒ³æ¸…ç†æ—§æ–‡ä»¶ï¼Ÿ

å¯ä»¥æ‰‹åŠ¨åˆ é™¤æ—§çš„ `.md` æ–‡ä»¶ï¼Œåªä¿ç•™æœ€è¿‘çš„åˆ†æç»“æœã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨æ›´æ–°åŸºå‡†æ–‡ä»¶æ•°ã€‚

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ–‡ä»¶åŸºå‡†ç®¡ç†å™¨ï¼ˆFileCountBaselineï¼‰

```python
# ä½ç½®ï¼šlogs/report_baseline.json

{
  "insight": 5,
  "media": 6,
  "query": 4
}

# ä½œç”¨ï¼š
# - è®°å½•ä¸Šæ¬¡ç”ŸæˆæŠ¥å‘Šæ—¶æ¯ä¸ªç›®å½•çš„æ–‡ä»¶æ•°
# - ç”¨äºåˆ¤æ–­æ˜¯å¦æœ‰æ–°æ–‡ä»¶ç”Ÿæˆ
# - æ–°æ–‡ä»¶æ•° = å½“å‰æ–‡ä»¶æ•° - åŸºå‡†æ–‡ä»¶æ•°
```

### åˆ¤æ–­é€»è¾‘

```python
# æ‰€æœ‰å¯ç”¨çš„å¼•æ“éƒ½å¿…é¡»æœ‰æ–°æ–‡ä»¶
ready = all(new_files_found[engine] > 0 for engine in enabled_engines)

# ç¤ºä¾‹ï¼š
# å¯ç”¨å¼•æ“ï¼š['media', 'query']
# new_files_found: {'media': 1, 'query': 1}
# ready = True âœ“

# å¯ç”¨å¼•æ“ï¼š['media', 'query', 'insight']
# new_files_found: {'media': 1, 'query': 0, 'insight': 1}
# ready = False âœ— (queryæ²¡æœ‰æ–°æ–‡ä»¶)
```

### ä»£ç ä½ç½®ç´¢å¼•

| åŠŸèƒ½ | æ–‡ä»¶ä½ç½® | å‡½æ•°å | è¡Œå· |
|------|---------|--------|------|
| æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å‡†å¤‡å°±ç»ª | `ReportEngine/agent.py` | `check_input_files_selective()` | 443-527 |
| è·å–æœ€æ–°æ–‡ä»¶ | `ReportEngine/agent.py` | `get_latest_files()` | 94-108 |
| åŠ è½½æ–‡ä»¶å†…å®¹ | `ReportEngine/agent.py` | `load_input_files()` | 537-571 |
| æ–‡ä»¶åŸºå‡†ç®¡ç† | `ReportEngine/agent.py` | `FileCountBaseline` ç±» | 18-109 |
| Flaskæ¥å£ | `ReportEngine/flask_interface.py` | `check_engines_ready()` | 107-147 |

---

## ğŸ¯ è®¾è®¡ä¼˜åŠ¿

### 1. æ™ºèƒ½æ–‡ä»¶é€‰æ‹©

**ä¼˜ç‚¹**ï¼š
- âœ… è‡ªåŠ¨è¯†åˆ«æœ€æ–°åˆ†æç»“æœ
- âœ… é¿å…æ‰‹åŠ¨æŒ‡å®šæ–‡ä»¶è·¯å¾„
- âœ… æ”¯æŒå¤šä¸»é¢˜å¹¶å­˜

**å®ç°**ï¼š
```python
# ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹æ—¶é—´ä½œä¸ºåˆ¤æ–­ä¾æ®
latest_file = max(md_files, key=lambda x: os.path.getmtime(os.path.join(directory, x)))
```

### 2. åŸºå‡†æ–‡ä»¶ç®¡ç†

**ä¼˜ç‚¹**ï¼š
- âœ… å‡†ç¡®åˆ¤æ–­æ˜¯å¦æœ‰æ–°æ–‡ä»¶
- âœ… é¿å…é‡å¤ç”ŸæˆæŠ¥å‘Š
- âœ… æ”¯æŒå¢é‡æ›´æ–°

**å®ç°**ï¼š
```python
# è®°å½•åŸºå‡†æ–‡ä»¶æ•°
baseline_counts = {"insight": 5, "media": 6, "query": 4}

# åˆ¤æ–­æ–°å¢
new_files_found = current_count - baseline_count
```

### 3. çµæ´»çš„å¼•æ“é…ç½®

**ä¼˜ç‚¹**ï¼š
- âœ… æ”¯æŒé€‰æ‹©æ€§å¯ç”¨å¼•æ“
- âœ… åªæ£€æŸ¥å¯ç”¨å¼•æ“çš„æ–‡ä»¶
- âœ… æé«˜ç”Ÿæˆæ•ˆç‡

**å®ç°**ï¼š
```python
# ä» .env è¯»å–å¯ç”¨çš„å¼•æ“
enabled_engines = {"insight": True, "media": True, "query": False}

# åªæ£€æŸ¥å¯ç”¨çš„å¼•æ“ç›®å½•
enabled_directories = {
    engine: path 
    for engine, path in directories.items() 
    if enabled_engines.get(engine, True)
}
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ–‡ä»¶æ‰«æä¼˜åŒ–

```python
# åªæ‰«æ .md æ–‡ä»¶ï¼Œå¿½ç•¥å…¶ä»–æ–‡ä»¶
md_files = [f for f in os.listdir(directory) if f.endswith(".md")]

# ä½¿ç”¨ max() ä¸€æ¬¡æ€§æ‰¾åˆ°æœ€æ–°æ–‡ä»¶ï¼Œé¿å…æ’åº
latest_file = max(md_files, key=lambda x: os.path.getmtime(os.path.join(directory, x)))
```

### ç¼“å­˜æœºåˆ¶

```python
# æ–‡ä»¶åŸºå‡†æ•°æ®ç¼“å­˜åœ¨ JSON æ–‡ä»¶ä¸­
baseline_file = "logs/report_baseline.json"

# é¿å…æ¯æ¬¡éƒ½é‡æ–°è®¡ç®—åŸºå‡†
if os.path.exists(self.baseline_file):
    with open(self.baseline_file, "r", encoding="utf-8") as f:
        return json.load(f)
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: å¦‚æœä¸¤ä¸ªæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ç›¸åŒæ€ä¹ˆåŠï¼Ÿ

**A**: `max()` å‡½æ•°ä¼šè¿”å›ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æ–‡ä»¶ã€‚å®é™…ä¸Šï¼Œæ–‡ä»¶ä¿®æ”¹æ—¶é—´ç²¾ç¡®åˆ°ç§’ï¼Œå‡ ä¹ä¸ä¼šå‡ºç°å®Œå…¨ç›¸åŒçš„æƒ…å†µã€‚

### Q2: å¦‚æœåˆ é™¤äº†æœ€æ–°æ–‡ä»¶ä¼šæ€æ ·ï¼Ÿ

**A**: ç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©å‰©ä½™æ–‡ä»¶ä¸­æœ€æ–°çš„é‚£ä¸ªã€‚å¦‚æœç›®å½•ä¸ºç©ºï¼Œä¼šè¿”å›ç©ºç»“æœï¼ŒReportEngine ä¼šæŠ¥é”™æç¤ºç¼ºå°‘è¾“å…¥æ–‡ä»¶ã€‚

### Q3: å¦‚ä½•å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šçš„å†å²æ–‡ä»¶ï¼Ÿ

**A**: å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒæ‰‹åŠ¨é€‰æ‹©æ–‡ä»¶ã€‚å¦‚æœéœ€è¦ä½¿ç”¨å†å²æ–‡ä»¶ï¼Œå¯ä»¥ï¼š
1. ä¿®æ”¹è¯¥æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼ˆ`touch` å‘½ä»¤ï¼‰
2. æˆ–è€…ä¸´æ—¶åˆ é™¤/ç§»åŠ¨å…¶ä»–æ–‡ä»¶

### Q4: åŸºå‡†æ–‡ä»¶æ•°ä»€ä¹ˆæ—¶å€™æ›´æ–°ï¼Ÿ

**A**: æ¯æ¬¡æˆåŠŸç”ŸæˆæŠ¥å‘Šåï¼Œç³»ç»Ÿä¼šè°ƒç”¨ `update_baseline()` æ›´æ–°åŸºå‡†æ–‡ä»¶æ•°ã€‚

```python
# ä½ç½®ï¼šReportEngine/agent.py
def update_baseline(self, directories: Dict[str, str]):
    """æ›´æ–°æ–‡ä»¶æ•°é‡åŸºå‡†"""
    for engine, directory in directories.items():
        if os.path.exists(directory):
            md_files = [f for f in os.listdir(directory) if f.endswith(".md")]
            self.baseline_data[engine] = len(md_files)
    self._save_baseline()
```

---

## ğŸ”„ å·¥ä½œæµç¨‹å›¾

```
ç”¨æˆ·å‘èµ·æœç´¢
    â†“
å¯ç”¨çš„å¼•æ“å¼€å§‹å·¥ä½œ
    â†“
ç”Ÿæˆæ–°çš„æŠ¥å‘Šæ–‡ä»¶ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
    â†“
ReportEngine æ£€æŸ¥çŠ¶æ€
    â”œâ”€ ç»Ÿè®¡ç›®å½•æ–‡ä»¶æ•°
    â”œâ”€ å¯¹æ¯”åŸºå‡†æ–‡ä»¶æ•°
    â””â”€ åˆ¤æ–­æ˜¯å¦æœ‰æ–°å¢ âœ“
    â†“
ReportEngine é€‰æ‹©æ–‡ä»¶
    â”œâ”€ æ‰«ææ‰€æœ‰ .md æ–‡ä»¶
    â”œâ”€ è·å–æ¯ä¸ªæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´
    â””â”€ é€‰æ‹©ä¿®æ”¹æ—¶é—´æœ€æ–°çš„1ä¸ª âœ“
    â†“
åŠ è½½æ–‡ä»¶å†…å®¹
    â”œâ”€ è¯»å–æœ€æ–°çš„ Query æŠ¥å‘Š
    â”œâ”€ è¯»å–æœ€æ–°çš„ Media æŠ¥å‘Š
    â”œâ”€ è¯»å–æœ€æ–°çš„ Insight æŠ¥å‘Š
    â””â”€ è¯»å– Forum æ—¥å¿—
    â†“
å‹ç¼©è¾“å…¥æ•°æ®
    â†“
è°ƒç”¨ LLM ç”ŸæˆæŠ¥å‘Š
    â†“
ä¿å­˜ HTML æŠ¥å‘Š
    â†“
æ›´æ–°åŸºå‡†æ–‡ä»¶æ•°
```

---

## ğŸ“ ä»£ç ç¤ºä¾‹

### å®Œæ•´çš„æ–‡ä»¶é€‰æ‹©æµç¨‹

```python
# 1. æ£€æŸ¥æ˜¯å¦æœ‰æ–°æ–‡ä»¶
def check_engines_ready() -> Dict[str, Any]:
    """æ£€æŸ¥å¯ç”¨çš„å­å¼•æ“æ˜¯å¦éƒ½æœ‰æ–°æ–‡ä»¶"""
    # è·å–å¯ç”¨çš„å¼•æ“é…ç½®
    enabled_engines = get_enabled_engines()
    
    # åªæ£€æŸ¥å¯ç”¨çš„å¼•æ“
    enabled_directories = {
        engine: path 
        for engine, path in directories.items() 
        if enabled_engines.get(engine, True)
    }
    
    # è°ƒç”¨agentçš„æ£€æŸ¥æ–¹æ³•
    return report_agent.check_input_files_selective(
        enabled_directories,
        forum_log_path,
        enabled_engines
    )

# 2. è·å–æœ€æ–°æ–‡ä»¶
def get_latest_files(directories: Dict[str, str]) -> Dict[str, str]:
    """è·å–æ¯ä¸ªç›®å½•çš„æœ€æ–°æ–‡ä»¶"""
    latest_files = {}
    
    for engine, directory in directories.items():
        if os.path.exists(directory):
            md_files = [f for f in os.listdir(directory) if f.endswith(".md")]
            if md_files:
                latest_file = max(
                    md_files,
                    key=lambda x: os.path.getmtime(os.path.join(directory, x)),
                )
                latest_files[engine] = os.path.join(directory, latest_file)
                
                # è®°å½•æ—¥å¿—
                logger.info(f"é€‰æ‹© {engine} æœ€æ–°æ–‡ä»¶: {latest_file}")
    
    return latest_files

# 3. åŠ è½½æ–‡ä»¶å†…å®¹
def load_input_files(file_paths: Dict[str, str]) -> Dict[str, Any]:
    """åŠ è½½è¾“å…¥æ–‡ä»¶å†…å®¹"""
    content = {"reports": [], "forum_logs": ""}
    
    engines = ["query", "media", "insight"]
    for engine in engines:
        if engine in file_paths:
            try:
                with open(file_paths[engine], "r", encoding="utf-8") as f:
                    report_content = f.read()
                content["reports"].append(report_content)
                logger.info(f"å·²åŠ è½½ {engine} æŠ¥å‘Š: {len(report_content)} å­—ç¬¦")
            except Exception as e:
                logger.exception(f"åŠ è½½ {engine} æŠ¥å‘Šå¤±è´¥: {str(e)}")
                content["reports"].append("")
    
    return content
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. æ–‡ä»¶å‘½åè§„èŒƒ

å»ºè®®ä½¿ç”¨åŒ…å«æ—¶é—´æˆ³çš„æ–‡ä»¶åï¼š
```
deep_search_report_{ä¸»é¢˜}_{æ—¶é—´æˆ³}.md

ç¤ºä¾‹ï¼š
deep_search_report_AI_Agentæµç¨‹è‡ªåŠ¨åŒ–_20251114_095854.md
```

**ä¼˜ç‚¹**ï¼š
- âœ… æ–‡ä»¶ååŒ…å«ä¸»é¢˜å’Œæ—¶é—´ä¿¡æ¯
- âœ… æ˜“äºè¯†åˆ«å’Œç®¡ç†
- âœ… æ”¯æŒæŒ‰æ—¶é—´æ’åº

### 2. å®šæœŸæ¸…ç†æ—§æ–‡ä»¶

å»ºè®®å®šæœŸæ¸…ç†æ—§çš„æŠ¥å‘Šæ–‡ä»¶ï¼š
```bash
# ä¿ç•™æœ€è¿‘7å¤©çš„æ–‡ä»¶
find media_engine_streamlit_reports/ -name "*.md" -mtime +7 -delete
```

### 3. å¤‡ä»½é‡è¦æŠ¥å‘Š

å¯¹äºé‡è¦çš„åˆ†ææŠ¥å‘Šï¼Œå»ºè®®ï¼š
- å¤åˆ¶åˆ°ä¸“é—¨çš„å¤‡ä»½ç›®å½•
- æˆ–è€…ä½¿ç”¨ Git è¿›è¡Œç‰ˆæœ¬ç®¡ç†

---

## ğŸ“Š ç»Ÿè®¡æ•°æ®

### æ–‡ä»¶é€‰æ‹©æ€§èƒ½

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **æ–‡ä»¶æ‰«ææ—¶é—´** | < 10ms | æ‰«æç›®å½•å¹¶è·å–æ–‡ä»¶åˆ—è¡¨ |
| **æ—¶é—´æˆ³è·å–** | < 1ms/æ–‡ä»¶ | è·å–å•ä¸ªæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ |
| **æ–‡ä»¶é€‰æ‹©** | < 5ms | ä½¿ç”¨ max() æ‰¾åˆ°æœ€æ–°æ–‡ä»¶ |
| **æ€»è€—æ—¶** | < 50ms | å®Œæ•´çš„æ–‡ä»¶é€‰æ‹©æµç¨‹ |

### å­˜å‚¨ç©ºé—´

| é¡¹ç›® | å¤§å° | è¯´æ˜ |
|------|------|------|
| **å•ä¸ªæŠ¥å‘Š** | 10-60 KB | Markdown æ ¼å¼ |
| **7ä¸ªæŠ¥å‘Š** | 70-420 KB | å†å²æŠ¥å‘Šç´¯ç§¯ |
| **åŸºå‡†æ–‡ä»¶** | < 1 KB | JSON æ ¼å¼ |

---

## ğŸ”® æœªæ¥ä¼˜åŒ–æ–¹å‘

### 1. æ™ºèƒ½æ–‡ä»¶ç®¡ç†

**ç›®æ ‡**ï¼šè‡ªåŠ¨ç®¡ç†å†å²æ–‡ä»¶

**æ–¹æ¡ˆ**ï¼š
- è‡ªåŠ¨å½’æ¡£æ—§æ–‡ä»¶åˆ° `archive/` ç›®å½•
- ä¿ç•™æœ€è¿‘ N ä¸ªæ–‡ä»¶
- æ”¯æŒæŒ‰ä¸»é¢˜åˆ†ç»„ç®¡ç†

### 2. æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶

**ç›®æ ‡**ï¼šæ”¯æŒæŸ¥çœ‹å’Œå¯¹æ¯”å†å²ç‰ˆæœ¬

**æ–¹æ¡ˆ**ï¼š
- é›†æˆ Git ç‰ˆæœ¬æ§åˆ¶
- æä¾› Web UI æŸ¥çœ‹å†å²
- æ”¯æŒç‰ˆæœ¬å¯¹æ¯”åŠŸèƒ½

### 3. å¤šæ–‡ä»¶æ•´åˆ

**ç›®æ ‡**ï¼šæ”¯æŒæ•´åˆå¤šä¸ªå†å²æŠ¥å‘Š

**æ–¹æ¡ˆ**ï¼š
- æä¾›"è¶‹åŠ¿åˆ†æ"æ¨¡å¼
- å¯¹æ¯”ä¸åŒæ—¶é—´çš„åˆ†æç»“æœ
- ç”Ÿæˆè¶‹åŠ¿å˜åŒ–æŠ¥å‘Š

### 4. è‡ªå®šä¹‰æ–‡ä»¶é€‰æ‹©

**ç›®æ ‡**ï¼šæ”¯æŒæ‰‹åŠ¨é€‰æ‹©è¦ä½¿ç”¨çš„æ–‡ä»¶

**æ–¹æ¡ˆ**ï¼š
- åœ¨å‰ç«¯æä¾›æ–‡ä»¶é€‰æ‹©ç•Œé¢
- æ”¯æŒå¤šé€‰å’Œæ‰¹é‡å¤„ç†
- ä¿å­˜ç”¨æˆ·çš„é€‰æ‹©åå¥½

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ReportEngineæ¶æ„è®¾è®¡](./ReportEngineæ¶æ„è®¾è®¡.md) - äº†è§£æ•´ä½“æ¶æ„
- [ReportEngineæ ¸å¿ƒç»„ä»¶](./ReportEngineæ ¸å¿ƒç»„ä»¶.md) - äº†è§£å„ä¸ªç»„ä»¶
- [ReportEngineæ™ºèƒ½å‹ç¼©æœºåˆ¶](./ReportEngineæ™ºèƒ½å‹ç¼©æœºåˆ¶.md) - äº†è§£æ•°æ®å‹ç¼©
- [ReportEngineè°ƒè¯•æ€»ç»“](./ReportEngineè°ƒè¯•æ€»ç»“.md) - å­¦ä¹ è°ƒè¯•ç»éªŒ

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-11-14
- âœ… æ·»åŠ æ–‡ä»¶é€‰æ‹©æœºåˆ¶è¯¦ç»†è¯´æ˜
- âœ… æ”¹è¿›æç¤ºä¿¡æ¯ï¼Œæ˜¾ç¤ºå°†ä½¿ç”¨çš„å…·ä½“æ–‡ä»¶å
- âœ… æ›´æ–°ä»£ç ç¤ºä¾‹å’ŒæŠ€æœ¯ç»†èŠ‚
- âœ… æ·»åŠ å¸¸è§é—®é¢˜è§£ç­”

---

**Happy Coding! ğŸš€**
