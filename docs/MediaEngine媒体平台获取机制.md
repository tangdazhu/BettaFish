# MediaEngine 媒体平台获取机制

## 概述

MediaEngine 查询的媒体平台**不是预先配置的**，而是通过 **Bocha AI Search API** 根据查询内容动态获取的。这使得 MediaEngine 能够访问全网任何公开网站，无平台限制。

---

## 核心机制

### 1. API 自动搜索

MediaEngine 使用 Bocha AI Search API 进行全网搜索，API 会：

- **全网索引**：在全球互联网范围内搜索相关内容
- **智能匹配**：自动返回与查询最相关的网页结果
- **动态更新**：实时获取最新的公开可访问网站内容

### 2. 智能排序算法

Bocha API 根据以下因素自动选择和排序网站：

| 因素 | 说明 |
|------|------|
| **相关性** | 内容与查询关键词的匹配度 |
| **权威性** | 网站的可信度和专业性评分 |
| **时效性** | 内容的发布时间和更新频率 |
| **质量** | 内容的完整性、准确性和深度 |

### 3. 动态结果特性

每次查询返回的网站可能不同，取决于：

- ✅ 查询的具体内容和关键词
- ✅ 当前互联网上可用的最新信息
- ✅ API 的实时索引状态
- ✅ 内容的相关性评分

---

## 实际案例分析

### 查询示例：财经投资分析

**查询内容**：
```
"小米集团 阿里巴巴集团 核心业务构成 盈利能力 毛利率 市场定位 2025"
```

**返回的媒体平台**：

#### 1. 财经媒体（10个）
- 今日头条 (m.toutiao.com)
- 同花顺财经 (10jqka.com.cn)
- 搜狐 (sohu.com)
- 网易 (163.com)
- 腾讯网 (qq.com)
- 东方财富 (eastmoney.com)
- 和讯网 (hexun.com)
- 证券之星 (stockstar.com)
- 雪球 (xueqiu.com)
- 老虎社区 (laohu8.com)

#### 2. 专业数据平台（6个）
- 阿里巴巴集团官网 (alibabagroup.com)
- 泰伯网 (taibo.cn)
- 小牛行研 (hangyan.co)
- 慧博投研资讯 (hibor.com.cn)
- 360doc个人图书馆 (360doc.cn)
- 原创力文档 (book118.com)

**为什么是这些网站？**

因为查询内容是**财经投资分析**类，Bocha API 自动识别并返回：
- ✅ 专业财经媒体
- ✅ 投资研究平台
- ✅ 公司官方信息源

### 不同查询的对比

| 查询类型 | 示例查询 | 可能返回的平台类型 |
|---------|---------|------------------|
| **财经分析** | "小米集团 阿里巴巴 盈利能力" | 财经媒体、投研平台、公司官网 |
| **产品评测** | "小米手机评测" | 科技媒体、评测网站、电商平台 |
| **技术文档** | "Python Flask 教程" | 技术博客、官方文档、开发者社区 |
| **新闻事件** | "特斯拉最新动态" | 新闻媒体、科技资讯、汽车网站 |

---

## 技术实现

### 代码架构

```python
# MediaEngine/tools/search.py

def comprehensive_search(query: str) -> str:
    """
    全面综合搜索（默认工具）
    
    特点：
    - 无预设网站列表
    - 全网动态搜索
    - 智能结果排序
    """
    return _search_internal(
        query=query,
        search_type="comprehensive",
    )

def _search_internal(query: str, search_type: str = "comprehensive"):
    """
    内部搜索实现
    
    流程：
    1. 构建 API 请求（只传查询关键词）
    2. Bocha API 自动搜索全网
    3. API 返回最相关的网页列表
    """
    # 1. 构建请求
    url = f"{settings.BOCHA_BASE_URL}/search"
    params = {"q": query}  # 只传查询关键词，无网站限制
    
    # 2. 调用 API
    response = requests.get(url, params=params, headers=headers)
    
    # 3. 解析结果
    data = response.json()
    web_pages = data.get("webPages", {}).get("value", [])
    
    # 返回的网页来自 API 的全网索引
    return web_pages
```

### API 响应示例

```json
{
  "code": 200,
  "data": {
    "webPages": {
      "totalEstimatedMatches": 10000000,
      "value": [
        {
          "name": "小米集团去年总收入3659亿元",
          "url": "https://m.sohu.com/a/873386933_289979/",
          "snippet": "红星资本局3月18日消息...",
          "siteName": "手机搜狐网",
          "datePublished": "2025-03-20T15:00:00+08:00"
        }
        // ... 更多结果
      ]
    },
    "images": {
      "value": [
        // 图片结果
      ]
    },
    "videos": null  // 本次查询无视频
  }
}
```

---

## 与其他引擎对比

### 三大引擎的平台来源机制

| 引擎 | 平台来源 | 是否预设 | 平台范围 | 动态性 |
|------|---------|---------|---------|--------|
| **MediaEngine** | Bocha API 全网搜索 | ❌ 否 | 全球互联网 | 完全动态 |
| **InsightEngine** | 本地数据库 | ✅ 是 | 固定7个社交平台 | 静态固定 |
| **QueryEngine** | Tavily API 新闻源 | ❌ 否 | 全球新闻媒体 | 动态新闻 |

### 详细对比

#### MediaEngine
- **平台获取**：Bocha API 根据查询内容自动返回
- **平台类型**：任何公开网站（新闻、博客、论坛、官网等）
- **平台数量**：无限制，每次查询约10-20个最相关网站
- **适用场景**：需要全网信息覆盖的综合分析

#### InsightEngine
- **平台获取**：预先配置的7个社交媒体平台
- **平台类型**：Bilibili、Weibo、Douyin、Kuaishou、XHS、Zhihu、Tieba
- **平台数量**：固定7个 + 1个新闻聚合
- **适用场景**：中国社交媒体舆情分析

#### QueryEngine
- **平台获取**：Tavily API 从新闻源动态获取
- **平台类型**：全球新闻媒体（CNN、BBC、Bloomberg、新华网等）
- **平台数量**：无限制，专注新闻类网站
- **适用场景**：实时新闻监测和分析

---

## 优势与特点

### 1. 无平台限制
- ✅ 可以访问全网任何公开网站
- ✅ 不受预设平台列表约束
- ✅ 覆盖范围最广

### 2. 智能匹配
- ✅ 自动返回最相关的专业平台
- ✅ 根据查询内容调整网站类型
- ✅ 权威性和质量保证

### 3. 动态适应
- ✅ 不同查询返回不同类型的网站
- ✅ 实时获取最新信息
- ✅ 自动适应互联网内容变化

### 4. 多模态支持
- ✅ 同时返回网页、图片、结构化数据
- ✅ 支持 AI 总结和追问
- ✅ 模态卡片增强展示

---

## 实际运行数据

### 本次查询统计

**查询主题**：对比港股的小米和阿里巴巴投资价值

**搜索次数**：5个段落 × 2-3次搜索 = 约12次搜索

**返回数据**：
- 网页：每次约10条
- 图片：每次2-4张
- 视频：0条（本次查询无相关视频）
- 模态卡：0个

**覆盖的网站类型**：
1. 财经新闻媒体（40%）
2. 专业投研平台（30%）
3. 公司官网（10%）
4. 综合门户网站（20%）

**时效性**：
- 最新内容：2025年11月
- 历史数据：2024年财报
- 时间跨度：近1年

---

## 配置说明

### 相关配置项

```python
# config.py

class Settings(BaseSettings):
    # Bocha AI Search API 配置
    BOCHA_WEB_SEARCH_API_KEY: str  # API密钥
    BOCHA_BASE_URL: str = "https://api.bochaai.com/v1"  # API基础URL
    
    # 搜索超时配置
    SEARCH_TIMEOUT: int = 30  # 单次搜索超时（秒）
    
    # 无需配置网站列表
    # API 会自动返回最相关的网站
```

### 环境变量

```bash
# .env

# Bocha API 配置（必需）
BOCHA_WEB_SEARCH_API_KEY=your_api_key_here
BOCHA_BASE_URL=https://api.bochaai.com/v1

# 搜索超时（可选）
SEARCH_TIMEOUT=30
```

---

## 使用建议

### 1. 查询优化
- ✅ 使用具体的关键词（如"小米集团 2024年财报"）
- ✅ 包含时间信息（如"2025"）
- ✅ 明确查询意图（如"盈利能力分析"）

### 2. 结果验证
- ✅ 检查返回网站的权威性
- ✅ 对比多个来源的信息
- ✅ 注意内容的发布时间

### 3. 成本控制
- ⚠️ 每次搜索都会调用 Bocha API（产生费用）
- ⚠️ 合理设置搜索次数和反思次数
- ⚠️ 使用缓存机制避免重复搜索

---

## 常见问题

### Q1: 为什么每次查询返回的网站不同？
**A**: 因为 Bocha API 会根据查询内容、时效性、相关性等因素动态排序，返回当前最相关的网站。

### Q2: 可以指定只搜索某些网站吗？
**A**: 当前版本不支持。如需特定平台数据，建议使用 InsightEngine（社交媒体）或 QueryEngine（新闻媒体）。

### Q3: 返回的网站数量可以调整吗？
**A**: 可以通过修改 API 请求参数调整，但默认返回约10条最相关结果已经足够。

### Q4: 如何保证返回网站的质量？
**A**: Bocha API 内置了权威性评分机制，会优先返回高质量、可信的网站。

### Q5: 支持搜索哪些语言的网站？
**A**: 支持全球多语言网站，但根据查询语言会优先返回对应语言的结果。

---

## 总结

MediaEngine 的媒体平台获取机制具有以下核心特点：

1. **动态获取**：通过 Bocha AI Search API 实时搜索全网
2. **智能匹配**：根据查询内容自动返回最相关的专业平台
3. **无限制性**：不受预设平台列表约束，覆盖全球互联网
4. **高质量**：API 内置权威性和质量评分机制
5. **多模态**：同时支持网页、图片、结构化数据

这种设计使得 MediaEngine 成为 BettaFish 项目中覆盖范围最广、灵活性最强的搜索引擎，适用于需要全网信息覆盖的综合分析场景。

---

## 相关文档

- [MediaEngine多模态搜索技术总结.md](./MediaEngine多模态搜索技术总结.md)
- [InsightEngine本地舆情数据库技术总结.md](./InsightEngine本地舆情数据库技术总结.md)
- [QueryEngine新闻查询技术总结.md](./QueryEngine新闻查询技术总结.md)
- [ReportEngine技术和方案总结.md](./ReportEngine技术和方案总结.md)
