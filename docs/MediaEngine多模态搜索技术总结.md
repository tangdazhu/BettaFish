# MediaEngine å¤šæ¨¡æ€æœç´¢æŠ€æœ¯æ€»ç»“

## ğŸ“‹ æ¦‚è¿°

MediaEngine æ˜¯ BettaFish é¡¹ç›®çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œä¸“é—¨è´Ÿè´£**å¤šæ¨¡æ€æ·±åº¦æœç´¢å’Œå†…å®¹åˆ†æ**ã€‚å®ƒé€šè¿‡æ•´åˆå¤šç§æœç´¢å·¥å…·å’Œ AI åˆ†æèƒ½åŠ›ï¼Œå®ç°å¯¹ç½‘é¡µã€å›¾ç‰‡ã€ç»“æ„åŒ–æ•°æ®ç­‰å¤šç§åª’ä½“å½¢å¼çš„ç»¼åˆåˆ†æã€‚

**ç‰ˆæœ¬**: 1.1  
**æœ€åæ›´æ–°**: 2025-11-12  
**æ ¸å¿ƒç‰¹æ€§**: å¤šæ¨¡æ€æœç´¢ã€AI æ·±åº¦åˆ†æã€åæ€è¿­ä»£ä¼˜åŒ–

---

## ğŸ¯ æ”¯æŒçš„åª’ä½“ç±»å‹

### 1. ç½‘é¡µå†…å®¹ (Webpage)
- **æ•°æ®ç»“æ„**: `WebpageResult`
- **åŒ…å«ä¿¡æ¯**:
  - æ ‡é¢˜ (name)
  - URL (url)
  - æ‘˜è¦ (snippet)
  - æ˜¾ç¤ºURL (display_url)
  - çˆ¬å–æ—¥æœŸ (date_last_crawled)

### 2. å›¾ç‰‡å†…å®¹ (Image)
- **æ•°æ®ç»“æ„**: `ImageResult`
- **åŒ…å«ä¿¡æ¯**:
  - å›¾ç‰‡åç§° (name)
  - å†…å®¹URL (content_url)
  - æ¥æºé¡µé¢URL (host_page_url)
  - ç¼©ç•¥å›¾URL (thumbnail_url)
  - å°ºå¯¸ä¿¡æ¯ (width, height)

### 3. ç»“æ„åŒ–æ•°æ® (Modal Cards)
- **æ•°æ®ç»“æ„**: `ModalCardResult`
- **æ”¯æŒç±»å‹**:
  - å¤©æ°”ä¿¡æ¯ (weather_china)
  - è‚¡ç¥¨æ•°æ® (stock)
  - ç™¾ç§‘çŸ¥è¯† (baike_pro)
  - åŒ»ç–—ä¿¡æ¯ (medical_common)
  - æ±‡ç‡ä¿¡æ¯
  - ç«è½¦ç¥¨ä¿¡æ¯
  - æ±½è½¦å‚æ•°
  - è§†é¢‘å†…å®¹ (video)

### 4. AI ç”Ÿæˆå†…å®¹
- **AI æ€»ç»“** (answer): åŸºäºæœç´¢ç»“æœçš„æ™ºèƒ½æ‘˜è¦
- **è¿½é—®å»ºè®®** (follow_ups): AI ç”Ÿæˆçš„ç›¸å…³é—®é¢˜

---

## ğŸ”§ æ ¸å¿ƒæœç´¢å·¥å…·

MediaEngine æä¾› **5 ç§ä¸“ä¸šçš„å¤šæ¨¡æ€æœç´¢å·¥å…·**ï¼ŒåŸºäº Bocha AI Search APIï¼š

### 1. comprehensive_search - å…¨é¢ç»¼åˆæœç´¢
```python
def comprehensive_search(query: str, max_results: int = 10) -> BochaResponse
```
- **é€‚ç”¨åœºæ™¯**: ä¸€èˆ¬æ€§ç ”ç©¶éœ€æ±‚ï¼Œéœ€è¦å®Œæ•´ä¿¡æ¯
- **è¿”å›å†…å®¹**: ç½‘é¡µ + å›¾ç‰‡ + AIæ€»ç»“ + è¿½é—® + æ¨¡æ€å¡
- **ç‰¹ç‚¹**: æœ€å¸¸ç”¨çš„åŸºç¡€å·¥å…·ï¼Œä¿¡æ¯æœ€å…¨é¢

### 2. web_search_only - çº¯ç½‘é¡µæœç´¢
```python
def web_search_only(query: str, max_results: int = 15) -> BochaResponse
```
- **é€‚ç”¨åœºæ™¯**: åªéœ€ç½‘é¡µé“¾æ¥å’Œæ‘˜è¦ï¼Œä¸éœ€è¦AIåˆ†æ
- **è¿”å›å†…å®¹**: ä»…ç½‘é¡µç»“æœ
- **ç‰¹ç‚¹**: é€Ÿåº¦å¿«ï¼Œæˆæœ¬ä½

### 3. search_for_structured_data - ç»“æ„åŒ–æ•°æ®æŸ¥è¯¢
```python
def search_for_structured_data(query: str) -> BochaResponse
```
- **é€‚ç”¨åœºæ™¯**: æŸ¥è¯¢å¤©æ°”ã€è‚¡ç¥¨ã€æ±‡ç‡ç­‰ç»“æ„åŒ–ä¿¡æ¯
- **è¿”å›å†…å®¹**: é‡ç‚¹è¿”å›æ¨¡æ€å¡ï¼ˆç»“æ„åŒ–æ•°æ®ï¼‰
- **ç‰¹ç‚¹**: ä¸“é—¨è§¦å‘"æ¨¡æ€å¡"æŸ¥è¯¢

### 4. search_last_24_hours - 24å°æ—¶å†…ä¿¡æ¯æœç´¢
```python
def search_last_24_hours(query: str) -> BochaResponse
```
- **é€‚ç”¨åœºæ™¯**: è¿½è¸ªçªå‘äº‹ä»¶æˆ–æœ€æ–°åŠ¨æ€
- **è¿”å›å†…å®¹**: è¿‡å»24å°æ—¶å†…å‘å¸ƒçš„å†…å®¹
- **ç‰¹ç‚¹**: æ—¶æ•ˆæ€§å¼ºï¼Œé€‚åˆæ–°é—»è¿½è¸ª

### 5. search_last_week - æœ¬å‘¨ä¿¡æ¯æœç´¢
```python
def search_last_week(query: str) -> BochaResponse
```
- **é€‚ç”¨åœºæ™¯**: å‘¨åº¦èˆ†æƒ…æ€»ç»“æˆ–å›é¡¾
- **è¿”å›å†…å®¹**: è¿‡å»ä¸€å‘¨å†…çš„ä¸»è¦æŠ¥é“
- **ç‰¹ç‚¹**: é€‚åˆè¶‹åŠ¿åˆ†æ

---

## ğŸ›¡ï¸ å¦‚ä½•çªç ´å®‰å…¨è®¿é—®é™åˆ¶

### 1. ä½¿ç”¨ä¸“ä¸š AI æœç´¢ API

**æ ¸å¿ƒç­–ç•¥**: ä¸ç›´æ¥çˆ¬å–ç½‘ç«™ï¼Œè€Œæ˜¯ä½¿ç”¨ **Bocha AI Search API**

```python
class BochaMultimodalSearch:
    BOCHA_BASE_URL = "https://api.bochaai.com/v1/ai-search"
    
    def __init__(self, api_key: str):
        self._headers = {
            'Authorization': f'Bearer {api_key}',
            'Content-Type': 'application/json',
            'Accept': '*/*'
        }
```

**ä¼˜åŠ¿**:
- âœ… åˆæ³•åˆè§„ï¼šé€šè¿‡å®˜æ–¹ API è®¿é—®
- âœ… æ— éœ€å¤„ç†åçˆ¬ï¼šAPI æä¾›å•†å·²è§£å†³
- âœ… ç¨³å®šå¯é ï¼šä¸“ä¸šæœåŠ¡ä¿éšœ
- âœ… å¤šæ¨¡æ€æ”¯æŒï¼šä¸€æ¬¡è°ƒç”¨è·å–å¤šç§æ•°æ®

### 2. é‡è¯•æœºåˆ¶ä¿éšœç¨³å®šæ€§

**å®ç°æ–¹å¼**: ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼å®ç°ä¼˜é›…é‡è¯•

```python
@with_graceful_retry(SEARCH_API_RETRY_CONFIG, default_return=BochaResponse(query="æœç´¢å¤±è´¥"))
def _search_internal(self, **kwargs) -> BochaResponse:
    # æ‰§è¡Œæœç´¢è¯·æ±‚
    response = requests.post(self.BOCHA_BASE_URL, headers=self._headers, json=payload, timeout=30)
    response.raise_for_status()
    return self._parse_search_response(response.json(), query)
```

**é‡è¯•é…ç½®**:
```python
SEARCH_API_RETRY_CONFIG = RetryConfig(
    max_retries=3,              # æœ€å¤šé‡è¯•3æ¬¡
    initial_delay=1.0,          # åˆå§‹å»¶è¿Ÿ1ç§’
    backoff_factor=2.0,         # æŒ‡æ•°é€€é¿
    max_delay=60.0,             # æœ€å¤§å»¶è¿Ÿ60ç§’
    retry_on_exceptions=(...)   # æ•è·ç½‘ç»œå¼‚å¸¸
)
```

**é‡è¯•ç­–ç•¥**:
1. **æŒ‡æ•°é€€é¿**: ç¬¬1æ¬¡é‡è¯•ç­‰å¾…1ç§’ï¼Œç¬¬2æ¬¡2ç§’ï¼Œç¬¬3æ¬¡4ç§’
2. **å¼‚å¸¸æ•è·**: è‡ªåŠ¨å¤„ç†ç½‘ç»œé”™è¯¯ã€è¶…æ—¶ã€è¿æ¥å¤±è´¥
3. **ä¼˜é›…é™çº§**: é‡è¯•å¤±è´¥åè¿”å›é»˜è®¤å€¼ï¼Œä¸ä¸­æ–­æµç¨‹
4. **ä¸­æ–­æ”¯æŒ**: æ”¯æŒç”¨æˆ·ä¸»åŠ¨åœæ­¢

### 3. è¯·æ±‚å‚æ•°ä¼˜åŒ–

**è¶…æ—¶æ§åˆ¶**:
```python
response = requests.post(url, headers=headers, json=payload, timeout=30)
```
- è®¾ç½®30ç§’è¶…æ—¶ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…
- è¶…æ—¶åè‡ªåŠ¨è§¦å‘é‡è¯•æœºåˆ¶

**éæµå¼è¯·æ±‚**:
```python
payload = {
    "stream": False,  # ä½¿ç”¨éæµå¼è·å–å®Œæ•´ç»“æœ
    "query": query,
    "count": max_results,
    "answer": True
}
```
- é€‚åˆ Agent å·¥å…·è°ƒç”¨
- ä¸€æ¬¡æ€§è·å–å®Œæ•´æ•°æ®

### 4. é”™è¯¯å¤„ç†æœºåˆ¶

**å¤šå±‚é”™è¯¯å¤„ç†**:

```python
try:
    response = requests.post(...)
    response.raise_for_status()  # HTTPçŠ¶æ€ç æ£€æŸ¥
    
    response_dict = response.json()
    if response_dict.get("code") != 200:  # APIè¿”å›ç æ£€æŸ¥
        logger.error(f"APIè¿”å›é”™è¯¯: {response_dict.get('msg')}")
        return BochaResponse(query=query)
    
    return self._parse_search_response(response_dict, query)
    
except requests.exceptions.RequestException as e:
    logger.exception(f"æœç´¢æ—¶å‘ç”Ÿç½‘ç»œé”™è¯¯: {str(e)}")
    raise e  # è®©é‡è¯•æœºåˆ¶å¤„ç†
except Exception as e:
    logger.exception(f"å¤„ç†å“åº”æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}")
    raise e
```

**é”™è¯¯å¤„ç†å±‚æ¬¡**:
1. **HTTP é”™è¯¯**: 4xx/5xx çŠ¶æ€ç 
2. **API é”™è¯¯**: ä¸šåŠ¡é€»è¾‘é”™è¯¯ç 
3. **ç½‘ç»œé”™è¯¯**: è¿æ¥å¤±è´¥ã€è¶…æ—¶
4. **è§£æé”™è¯¯**: JSON è§£æå¤±è´¥

### 5. API å¯†é’¥ç®¡ç†

**å®‰å…¨é…ç½®**:
```python
def __init__(self, api_key: Optional[str] = None):
    if api_key is None:
        api_key = settings.BOCHA_WEB_SEARCH_API_KEY  # ä»ç¯å¢ƒå˜é‡è¯»å–
        if not api_key:
            raise ValueError("Bocha API Keyæœªæ‰¾åˆ°ï¼")
    
    self._headers = {
        'Authorization': f'Bearer {api_key}',  # Bearer Token è®¤è¯
        ...
    }
```

**æœ€ä½³å®è·µ**:
- âœ… ä» `.env` æ–‡ä»¶è¯»å–å¯†é’¥
- âœ… ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç 
- âœ… ä½¿ç”¨ Bearer Token æ ‡å‡†è®¤è¯
- âœ… å¯†é’¥éªŒè¯å¤±è´¥æ—¶åŠæ—¶æŠ¥é”™

---

## ğŸ”„ æ·±åº¦ç ”ç©¶å·¥ä½œæµç¨‹

MediaEngine é‡‡ç”¨**åæ€è¿­ä»£**çš„æ·±åº¦ç ”ç©¶æ–¹æ³•ï¼š

### å·¥ä½œæµç¨‹å›¾

```
ç”¨æˆ·æŸ¥è¯¢
    â†“
1. ç”ŸæˆæŠ¥å‘Šç»“æ„ (ReportStructureNode)
    â†“
2. å¯¹æ¯ä¸ªæ®µè½:
    â”œâ”€ 2.1 é¦–æ¬¡æœç´¢ (FirstSearchNode)
    â”‚   â”œâ”€ é€‰æ‹©æœç´¢å·¥å…·
    â”‚   â”œâ”€ ç”Ÿæˆæœç´¢æŸ¥è¯¢
    â”‚   â””â”€ æ‰§è¡Œæœç´¢
    â”‚
    â”œâ”€ 2.2 é¦–æ¬¡æ€»ç»“ (FirstSummaryNode)
    â”‚   â””â”€ åŸºäºæœç´¢ç»“æœç”Ÿæˆåˆå§‹å†…å®¹
    â”‚
    â””â”€ 2.3 åæ€å¾ªç¯ (æœ€å¤š3æ¬¡)
        â”œâ”€ åæ€åˆ†æ (ReflectionNode)
        â”‚   â”œâ”€ è¯†åˆ«ä¿¡æ¯ç¼ºå£
        â”‚   â”œâ”€ é€‰æ‹©è¡¥å……å·¥å…·
        â”‚   â””â”€ ç”Ÿæˆæ–°æŸ¥è¯¢
        â”‚
        â”œâ”€ æ‰§è¡Œè¡¥å……æœç´¢
        â”‚
        â””â”€ åæ€æ€»ç»“ (ReflectionSummaryNode)
            â””â”€ ä¸°å¯Œå’Œå®Œå–„å†…å®¹
    â†“
3. æ ¼å¼åŒ–æœ€ç»ˆæŠ¥å‘Š (ReportFormattingNode)
    â†“
4. ä¿å­˜æŠ¥å‘Š
```

### å…³é”®ç‰¹æ€§

#### 1. æ™ºèƒ½å·¥å…·é€‰æ‹©
```python
# LLM è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æœç´¢å·¥å…·
{
    "search_query": "äººå·¥æ™ºèƒ½å¯¹æœªæ¥æ•™è‚²çš„å½±å“",
    "search_tool": "comprehensive_search",  # AIé€‰æ‹©
    "reasoning": "éœ€è¦å…¨é¢äº†è§£è¯¥ä¸»é¢˜ï¼Œé€‰æ‹©ç»¼åˆæœç´¢"
}
```

#### 2. åæ€è¿­ä»£ä¼˜åŒ–
```python
for reflection_i in range(MAX_REFLECTIONS):  # é»˜è®¤3æ¬¡
    # åæ€å½“å‰å†…å®¹
    reflection_output = self.reflection_node.run(reflection_input)
    
    # è¡¥å……æœç´¢
    search_response = self.execute_search_tool(...)
    
    # æ›´æ–°å†…å®¹
    self.state = self.reflection_summary_node.mutate_state(...)
```

#### 3. å¤šæ¨¡æ€å†…å®¹æ•´åˆ
```python
# æœç´¢ç»“æœåŒ…å«å¤šç§åª’ä½“
search_results = []
for result in search_response.webpages:
    search_results.append({
        'title': result.name,
        'url': result.url,
        'content': result.snippet,
        'published_date': result.date_last_crawled
    })
```

---

## ğŸ§  AI åˆ†æèƒ½åŠ›

### 1. å¤šæ¨¡æ€å†…å®¹åˆ†æ

**åˆ†æç»´åº¦**:
- **æ–‡æœ¬å†…å®¹**: è¯¦ç»†åˆ†æç½‘é¡µæ–‡å­—ã€æ•°æ®ã€è§‚ç‚¹
- **å›¾ç‰‡ä¿¡æ¯**: è§£è¯»å›¾ç‰‡ä¼ è¾¾çš„ä¿¡æ¯ã€æƒ…æ„Ÿã€è§†è§‰å…ƒç´ 
- **AI æ€»ç»“**: æç‚¼å…³é”®è§‚ç‚¹å’Œè¶‹åŠ¿
- **ç»“æ„åŒ–æ•°æ®**: åˆ©ç”¨å¤©æ°”ã€è‚¡ç¥¨ç­‰ç»“æ„åŒ–ä¿¡æ¯

### 2. æ·±åº¦åˆ†æè¦æ±‚

**å†…å®¹è¦æ±‚** (æ¥è‡ª Prompt):
```
æ¯æ®µä¸å°‘äº800-1200å­—
æ¯100å­—è‡³å°‘åŒ…å«2-3ä¸ªæ¥è‡ªä¸åŒä¿¡æ¯æºçš„å…·ä½“ä¿¡æ¯ç‚¹
å……åˆ†åˆ©ç”¨æœç´¢ç»“æœçš„å¤šæ ·æ€§å’Œä¸°å¯Œæ€§
å®ç°æ–‡å­—ã€å›¾åƒã€æ•°æ®çš„æœ‰æœºç»“åˆ
```

**åˆ†æå±‚æ¬¡**:
1. **å…³è”åˆ†æ**: ä¸åŒä¿¡æ¯æºçš„å…³è”æ€§å’Œä¸€è‡´æ€§
2. **å¯¹æ¯”åˆ†æ**: ä¸åŒæ¥æºä¿¡æ¯çš„å·®å¼‚å’Œäº’è¡¥æ€§
3. **è¶‹åŠ¿åˆ†æ**: åŸºäºå¤šæºä¿¡æ¯åˆ¤æ–­å‘å±•è¶‹åŠ¿
4. **å½±å“è¯„ä¼°**: è¯„ä¼°äº‹ä»¶æˆ–è¯é¢˜çš„å½±å“èŒƒå›´

### 3. æŠ¥å‘Šç”Ÿæˆèƒ½åŠ›

**æœ€ç»ˆæŠ¥å‘Šç‰¹ç‚¹**:
- ğŸ“Š **ç«‹ä½“åŒ–**: ä»å¤šä¸ªæ„Ÿå®˜å’Œç»´åº¦ç†è§£åˆ†æå¯¹è±¡
- ğŸ¯ **å…¨æ™¯å¼**: ä¸å°‘äºä¸€ä¸‡å­—çš„ç»¼åˆåˆ†æ
- ğŸ“ˆ **æ•°æ®é©±åŠ¨**: é‡åŒ–è¯„ä¼°å’Œå¯¹æ¯”åˆ†æ
- ğŸ” **æ·±åº¦æ´å¯Ÿ**: æä¾›ä¼ ç»Ÿå•ä¸€åª’ä½“åˆ†ææ— æ³•å®ç°çš„æ´å¯Ÿ

---

## ğŸ’¡ æŠ€æœ¯åˆ›æ–°ç‚¹

### 1. å·¥å…·è‡ªåŠ¨é€‰æ‹©
- LLM æ ¹æ®æŸ¥è¯¢æ„å›¾è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æœç´¢å·¥å…·
- æ— éœ€äººå·¥åˆ¤æ–­ï¼Œæé«˜æ•ˆç‡

### 2. åæ€è¿­ä»£æœºåˆ¶
- è‡ªåŠ¨è¯†åˆ«ä¿¡æ¯ç¼ºå£
- è¿­ä»£è¡¥å……å®Œå–„å†…å®¹
- æœ€å¤š3è½®åæ€ä¼˜åŒ–

### 3. å¤šæ¨¡æ€èåˆ
- ç»Ÿä¸€å¤„ç†æ–‡å­—ã€å›¾ç‰‡ã€æ•°æ®
- è·¨åª’ä½“å…³è”åˆ†æ
- ç»¼åˆè¯„ä¼°ä¼ æ’­æ•ˆæœ

### 4. ä¼˜é›…é™çº§
- æœç´¢å¤±è´¥è¿”å›é»˜è®¤å€¼
- JSON è§£æå¤±è´¥è‡ªåŠ¨ä¿®å¤
- LLM æ ¼å¼åŒ–å¤±è´¥ä½¿ç”¨å¤‡ç”¨æ–¹æ³•

### 5. ä¸­æ–­æ”¯æŒ
- æ”¯æŒç”¨æˆ·ä¸»åŠ¨åœæ­¢ä»»åŠ¡
- æ£€æŸ¥åœæ­¢ä¿¡å·è´¯ç©¿æ•´ä¸ªæµç¨‹
- ä¼˜é›…é€€å‡ºä¸å½±å“å·²å®Œæˆéƒ¨åˆ†

---

## ğŸ“Š æ•°æ®æµè½¬

### è¾“å…¥ â†’ å¤„ç† â†’ è¾“å‡º

```
ç”¨æˆ·æŸ¥è¯¢
    â†“
[ReportStructureNode]
    â†“
æ®µè½ç»“æ„ (title, content)
    â†“
[FirstSearchNode]
    â†“
æœç´¢æŸ¥è¯¢ + å·¥å…·é€‰æ‹©
    â†“
[BochaMultimodalSearch]
    â†“
BochaResponse (webpages, images, modal_cards, answer)
    â†“
[FirstSummaryNode]
    â†“
åˆå§‹æ®µè½å†…å®¹
    â†“
[ReflectionNode] Ã— 3
    â†“
è¡¥å……æœç´¢æŸ¥è¯¢
    â†“
[ReflectionSummaryNode]
    â†“
å®Œå–„çš„æ®µè½å†…å®¹
    â†“
[ReportFormattingNode]
    â†“
æœ€ç»ˆæŠ¥å‘Š (Markdown)
```

---

## ğŸ” å®‰å…¨æ€§æ€»ç»“

### è®¿é—®æ§åˆ¶
1. âœ… **API è®¤è¯**: Bearer Token æ ‡å‡†è®¤è¯
2. âœ… **å¯†é’¥ç®¡ç†**: ç¯å¢ƒå˜é‡å­˜å‚¨ï¼Œä¸ç¡¬ç¼–ç 
3. âœ… **æƒé™éªŒè¯**: API å¯†é’¥éªŒè¯å¤±è´¥åŠæ—¶æŠ¥é”™

### ç¨³å®šæ€§ä¿éšœ
1. âœ… **é‡è¯•æœºåˆ¶**: 3æ¬¡é‡è¯• + æŒ‡æ•°é€€é¿
2. âœ… **è¶…æ—¶æ§åˆ¶**: 30ç§’è¶…æ—¶é¿å…é•¿æ—¶é—´ç­‰å¾…
3. âœ… **é”™è¯¯å¤„ç†**: å¤šå±‚é”™è¯¯æ•è·å’Œå¤„ç†
4. âœ… **ä¼˜é›…é™çº§**: å¤±è´¥ä¸ä¸­æ–­ï¼Œè¿”å›é»˜è®¤å€¼

### åˆè§„æ€§
1. âœ… **åˆæ³•è®¿é—®**: é€šè¿‡å®˜æ–¹ API è€Œéçˆ¬è™«
2. âœ… **å°Šé‡é™åˆ¶**: éµå®ˆ API è°ƒç”¨é¢‘ç‡é™åˆ¶
3. âœ… **æ•°æ®ä½¿ç”¨**: ä»…ç”¨äºç ”ç©¶åˆ†æï¼Œä¸è¿è§„ä½¿ç”¨

---

## ğŸ“š æŠ€æœ¯æ ˆ

### æ ¸å¿ƒä¾èµ–
- **requests**: HTTP è¯·æ±‚åº“
- **loguru**: æ—¥å¿—è®°å½•
- **dataclasses**: æ•°æ®ç»“æ„å®šä¹‰
- **OpenAI SDK**: LLM è°ƒç”¨ï¼ˆå…¼å®¹å¤šç§æ¨¡å‹ï¼‰

### API æœåŠ¡
- **Bocha AI Search**: å¤šæ¨¡æ€æœç´¢ API
- **é€šä¹‰åƒé—®/å…¶ä»– LLM**: å†…å®¹åˆ†æå’Œç”Ÿæˆ

### è®¾è®¡æ¨¡å¼
- **è£…é¥°å™¨æ¨¡å¼**: é‡è¯•æœºåˆ¶
- **å·¥å‚æ¨¡å¼**: Agent åˆ›å»º
- **çŠ¶æ€æ¨¡å¼**: ç ”ç©¶çŠ¶æ€ç®¡ç†
- **ç­–ç•¥æ¨¡å¼**: å¤šç§æœç´¢å·¥å…·

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```python
from MediaEngine import DeepSearchAgent

# åˆ›å»º Agent
agent = DeepSearchAgent()

# æ‰§è¡Œæ·±åº¦ç ”ç©¶
report = agent.research("äººå·¥æ™ºèƒ½å¯¹æœªæ¥æ•™è‚²çš„å½±å“")

# æŠ¥å‘Šè‡ªåŠ¨ä¿å­˜åˆ° OUTPUT_DIR
```

### è‡ªå®šä¹‰é…ç½®
```python
from MediaEngine.utils import Settings

# è‡ªå®šä¹‰é…ç½®
config = Settings()
config.MAX_REFLECTIONS = 5  # å¢åŠ åæ€æ¬¡æ•°
config.SEARCH_CONTENT_MAX_LENGTH = 2000  # å¢åŠ å†…å®¹é•¿åº¦

# åˆ›å»º Agent
agent = DeepSearchAgent(config=config)
```

### æ”¯æŒä¸­æ–­
```python
import threading

# åˆ›å»ºåœæ­¢äº‹ä»¶
stop_event = threading.Event()

# åˆ›å»ºæ”¯æŒä¸­æ–­çš„ Agent
agent = DeepSearchAgent(stop_event=stop_event)

# åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œç ”ç©¶
def do_research():
    try:
        report = agent.research("é‡å­è®¡ç®—å•†ä¸šåŒ–")
    except InterruptedError:
        print("ç ”ç©¶è¢«ç”¨æˆ·ä¸­æ–­")

# ç”¨æˆ·å¯ä»¥éšæ—¶åœæ­¢
stop_event.set()
```

---

## ğŸ“– å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£
- [Bocha AI Search API](https://api.bochaai.com/)
- [OpenAI API](https://platform.openai.com/docs)
- [é€šä¹‰åƒé—® API](https://help.aliyun.com/zh/model-studio/)

### é¡¹ç›®æ–‡ä»¶
- `MediaEngine/agent.py`: ä¸» Agent å®ç°
- `MediaEngine/tools/search.py`: æœç´¢å·¥å…·é›†
- `MediaEngine/prompts/prompts.py`: æç¤ºè¯å®šä¹‰
- `utils/retry_helper.py`: é‡è¯•æœºåˆ¶å®ç°

---

**æ–‡æ¡£ç»´æŠ¤**: BettaFish é¡¹ç›®ç»„  
**æœ€åæ›´æ–°**: 2025-11-12  
**ç‰ˆæœ¬**: v1.0
